import{T as w,cz as v,U as _,_ as I,d as s,o as r,e as p,w as c,h as m,f as $,F as y,p as P}from"./index.ec7eb99e.js";import{u}from"./PlanCard.3180e3c1.js";const k={props:{user:Object},data(){return{loading:!1,columns:[{name:"created_at",label:this.$t("label.date"),field:"created_at",format:this.$core.formatDateAsHuman,align:"left"},{name:"amount",label:this.$t("label.amount"),field:"amount",align:"left"},{name:"status",label:this.$t("label.status"),field:"status",format:e=>e==null?void 0:e.map(t=>t.label),align:"left"},{name:"actions",field:"actions",align:"right"}],pagination:{page:1,rowsPerPage:10,rowsNumber:10,loaded:!1}}},methods:{...w(u,["getInvoices","downloadInvoice","setUser"]),async onRequest(e){console.func("components/payment-methods/InvoiceManager:methods.onRequest()",arguments),this.loading=!0;const{page:t,rowsPerPage:a}=e.pagination;await this.setUser(this.user),this.getInvoices({page:t,rowsPerPage:a}).then(o=>{this.pagination.rowsNumber=o.total,this.pagination.page=t,this.pagination.rowsPerPage=a,this.pagination.from=o.from,this.pagination.to=o.to,this.pagination.loaded=!0,this.loading=!1}).catch(o=>{this.$emit("error",o)})},onViewInvoice(e){console.func("components/payment-methods/InvoiceManager:methods.onViewInvoice()",arguments),e.row.loading=!0,this.downloadInvoice(e==null?void 0:e.row.id).then(t=>{e.row.loading=!1;const a=new Blob([t],{type:"application/pdf"});this.$q.dialog({component:v,componentProps:{title:`Invoice-${e==null?void 0:e.row.number}.pdf`,url:URL.createObjectURL(a)}}).onOk(o=>{URL.revokeObjectURL(o)})}).catch(t=>{e.row.loading=!1,this.$core.error(t,{title:this.$t("dialog.title.error")})})}},computed:{..._(u,["invoices"])}};function R(e,t,a,o,i,d){const g=s("base-status"),b=s("base-btn"),h=s("base-table"),f=s("base-section");return r(),p(f,{flat:"",bordered:"","no-row":"",title:e.$t("invoices.historyTitle"),description:e.$t("invoices.historyDesc"),class:"invoice-manager"},{default:c(()=>[m(h,{rowsPerPageOptions:[0],rows:e.invoices,columns:i.columns,"no-data-label":e.$t("invoices.noData"),pagination:i.pagination,"onUpdate:pagination":t[0]||(t[0]=n=>i.pagination=n),onRequest:d.onRequest,loading:i.loading,"hide-top":"","has-actions":""},{"body-cell-status":c(n=>[(r(!0),$(y,null,P(n.value,l=>(r(),p(g,{type:l,key:l},null,8,["type"]))),128))]),actions:c(n=>[m(b,{link:"",color:"grey",loading:n.row.loading,onClick:l=>d.onViewInvoice(n),label:e.$t("invoices.viewLabel")},null,8,["loading","onClick","label"])]),_:1},8,["rows","columns","no-data-label","pagination","onRequest","loading"])]),_:1},8,["title","description"])}var L=I(k,[["render",R]]);export{L as I};
