import{Q as w}from"./QBanner.29df4abb.js";import{Q as B}from"./QPopupProxy.64b9fae0.js";import{T as y,_ as q,d as b,o as i,e as k,w as l,h as r,j as p,t as u,g as $,f as g,F as x,p as P,i as N,ad as A,s as Q,ag as R}from"./index.ec7eb99e.js";import{u as V}from"./member.8ccf3331.js";import{u as D}from"./class-schedule.9cf3b7cc.js";const T=e=>{var c,d;let t=[];return(c=e==null?void 0:e.booking)!=null&&c.same_day_canceled?t.push("text-red text-bold"):(d=e==null?void 0:e.booking)!=null&&d.is_standby&&t.push("bg-amber-1"),t.join(" ")},U={props:{moduleId:[Number,String],status:{type:String,default:"active"},noAction:Boolean},data(){return{rows:[],loading:!1,pagination:{sortBy:"date_at",descending:!0,page:1,filter:"",status:this.status,deleted:!1,rowsPerPage:10,rowsNumber:10,loaded:!1}}},methods:{...y(V,["schedules"]),...y(D,["cancel"]),onRequest(e){console.func("components/UserClassSchedules:methods.onRequest()",arguments),this.pagination={...e.pagination};const{page:t,rowsPerPage:c,sortBy:d,descending:o,date:a}=e.pagination;this.loading=!0,typeof a=="object"&&a?(e.pagination.date_from=a.from,e.pagination.date_to=a.to,delete e.pagination.date):(delete e.pagination.date_from,delete e.pagination.date_to),this.schedules({...e.pagination,moduleId:this.moduleId,direction:o?"desc":"asc"}).then(({meta:n,data:h})=>{this.rows=h,this.pagination.rowsNumber=n.total,this.pagination.page=t,this.pagination.rowsPerPage=c,this.pagination.sortBy=d,this.pagination.descending=o,this.pagination.loaded=!0,this.pagination.from=n.from,this.pagination.to=n.to,this.loading=!1}).catch(n=>{this.$core.error(n,{title:this.$t("dialog.title.error")})})},onCancel({row:e}){console.func("components/UserClassSchedules:methods.onCancel()",arguments),e.loading=!0,this.cancel(e).then(()=>{e.loading=!1,e.booking.cancelable=!1}).catch(t=>{e.loading=!1})}},computed:{visibleColumns(){return this.columns.filter(e=>{if(!this.noAction&&e.name==="actions")return!0;if(e.status){if(e.status&&e.status.includes(this.pagination.status))return!0}else return!0;return!1}).map(e=>e.name)},columns(){return[{name:"date_at",align:"left",label:this.$t("label.day"),field:e=>`${e.day} - ${e.date_at_formated}`,style:"width: 40px",classes:e=>{var t;return(t=e.booking)!=null&&t.is_standby?"bg-amber-1":""}},{name:"start_at",align:"left",label:this.$t("label.time"),field:e=>`${e.time}`,classes:e=>{var t;return(t=e.booking)!=null&&t.is_standby?"bg-amber-1":""}},{name:"class",align:"left",label:this.$t("label.class"),field:"class",format:e=>e?e.name:"",classes:e=>{var t;return(t=e.booking)!=null&&t.is_standby?"bg-amber-1":""}},{name:"location",align:"left",label:this.$t("label.location"),field:"location",format:e=>e?e.label:"",classes:e=>{var t;return(t=e.booking)!=null&&t.is_standby?"bg-amber-1":""}},{name:"instructor",align:"left",label:this.$t("label.instructor"),field:"instructor",format:e=>e?e.name:"",classes:e=>{var t;return(t=e.booking)!=null&&t.is_standby?"bg-amber-1":""}},{name:"canceled_at",align:"left",label:this.$t("label.canceledAt"),field:e=>e.booking.canceled_at,format:this.$core.formatDateAsHuman,classes:T,status:["cancelled","late-cancellation"]},{name:"is_standby",align:"left",field:e=>e.booking.is_standby,format:e=>e?'<strong class="text-negative">Standby</strong>':"",classes:e=>{var t;return(t=e.booking)!=null&&t.is_standby?"bg-amber-1":""},status:[null,"active"]},{name:"actions",align:"right",classes:e=>{var t;return(t=e.booking)!=null&&t.is_standby?"bg-amber-1":""}}]},toolbar(){return[{title:this.$t("label.date"),action:"request",component:"base-date-input",dense:!0,outlined:!0,key:"date",placeholder:this.$t("placeholder.select"),style:"width: 150px",prefix:this.$t("prefix.date"),deleted:"all"},{title:this.$t("label.status"),action:"request",component:"base-select",dense:!0,outlined:!0,key:"status",placeholder:this.$t("placeholder.select"),optionsDense:!0,style:"width: 180px",mapOptions:!0,emitValue:!0,options:[{label:this.$t("label.all"),value:null},{label:this.$t("label.active"),value:"active"},{label:this.$t("label.attended"),value:"attended"},{label:this.$t("label.cancelled"),value:"cancelled"},{label:this.$t("label.lateCancellation"),value:"late-cancellation"},{label:this.$t("label.noShow"),value:"noshow"}],deleted:"all",prefix:this.$t("prefix.status")}]}}},j=["innerHTML"],H={key:0,class:"q-mt-sm"},I=["href"],L={key:1};function M(e,t,c,d,o,a){const n=b("base-label"),h=b("base-btn"),v=b("base-tooltip"),C=b("base-table");return i(),k(C,{toolbar:a.toolbar,loading:o.loading,pagination:o.pagination,onRequest:a.onRequest,"no-permissions":"",columns:a.columns,rows:o.rows,"no-data-label":e.$t("classes.noBookings"),"quick-search-placeholder":e.$t("placeholder.quickSearchClasses"),"visible-columns":a.visibleColumns,"has-actions":""},{"body-cell-class":l(s=>{var m,_;return[(_=(m=s.row)==null?void 0:m.class)!=null&&_.has_description?(i(),k(h,{key:0,link:"",label:s.value},{default:l(()=>[r(B,null,{default:l(()=>[r(w,{style:{width:"350px"}},{default:l(()=>[r(n,null,{default:l(()=>[p(u(e.$t("description")),1)]),_:1}),$("span",{innerHTML:e.$core.nl2br(s.row.class.description)},null,8,j),s.row.class.urls?(i(),g("div",H,[r(n,null,{default:l(()=>[p(u(e.$t("urls")),1)]),_:1}),(i(!0),g(x,null,P(s.row.class.urls,(f,S)=>(i(),g("div",{key:S},[$("a",{href:f.url},u(f.label||f.url),9,I)]))),128))])):N("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"])):(i(),g("span",L,u(s.value),1))]}),actions:l(s=>[A(r(Q,{color:"primary",icon:"fas fa-calendar-circle-minus",onClick:m=>a.onCancel(s),size:"sm",round:"",flat:"",loading:s.row.loading},{default:l(()=>[r(v,null,{default:l(()=>[p(u(e.$t("cancelBooking")),1)]),_:1})]),_:2},1032,["onClick","loading"]),[[R,s.row.booking.cancelable]])]),_:1},8,["toolbar","loading","pagination","onRequest","columns","rows","no-data-label","quick-search-placeholder","visible-columns"])}var J=q(U,[["render",M]]);export{J as U};
