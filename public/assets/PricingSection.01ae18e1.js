import{bt as L,A as g,m as f,c as I,_ as q,o as v,e as V,w as p,g as d,h as i,ak as U,j as h,X as S,cw as D,ah as x,f as _,t as b,s as w,d as y,i as $,V as O,F as E,p as Q,O as k,al as j,ad as B,af as C,aq as A}from"./index.ec7eb99e.js";import{Q as N}from"./QTd.ce5eb0a5.js";import{c as z}from"./QTable.e99aec6c.js";import{Q as T}from"./QPopupEdit.9b1b213c.js";const $e=L("product/variant",{state:()=>({default:[]}),getters:{module:e=>({name:"Variants",label:e.$t("label.variants"),singular:e.$t("singular.variant"),plural:e.$t("plural.variants")}),columns:e=>[{name:"title",align:"left",label:e.$t("label.product"),field:"title",style:"width: 250px; white-space: normal;",sortable:!0},{name:"inventory_html",align:"left",label:e.$t("label.inventory"),field:"inventory_html",sortable:!1},{name:"category",align:"left",label:e.$t("label.category"),field:"category",format:t=>t==null?void 0:t.name,sortable:!1},{name:"vendor",align:"left",label:e.$t("label.vendor"),field:"vendor",format:t=>t==null?void 0:t.name,sortable:!1},{name:"price",align:"left",label:e.$t("label.price"),field:"price",format:price,style:"width: 40px",sortable:!1},{name:"status",align:"left",label:e.$t("label.status"),field:"status",sortable:!1},{name:"actions",align:"right",sortable:!1}],actions:e=>[{label:e.$t("label.edit"),action:"route",route:"Product",params:t=>({id:t.id}),query:t=>({action:"edit"}),icon:"fas fa-edit",deleted:!1},{label:e.$t("label.delete"),action:"delete",icon:"fas fa-trash-alt",deleted:!1},{label:e.$t("label.restore"),action:"restore",icon:"fas fa-trash-undo",deleted:!0}],toolbar:e=>[{title:e.$t("label.status"),action:"request",component:"base-select",dense:!0,outlined:!0,key:"active",placeholder:e.$t("placeholder.select"),optionsDense:!0,style:"width: 150px",mapOptions:!0,emitValue:!0,options:statusOptions(e),prefix:e.$t("prefix.status"),deleted:"all"},{title:e.$t("label.sortBy"),action:"request",component:"base-select",dense:!0,outlined:!0,key:"sortBy","options-dense":!0,"map-options":!0,"emit-value":!0,icon:"fas fa-sort",style:"min-width: 200px",options:sortOptions(e),deleted:"all"},{label:e.$t("label.filters"),icon:"fas fa-sort-alt",action:"filter",color:"grey-6",outline:!0,deleted:"all"},{icon:"fad fa-plus-circle",label:e.$t("label.addProduct"),permission:"New",action:"route",params:{id:"add"},route:"Product",color:"primary",deleted:"all"}],filters:e=>[{title:e.$t("label.vendor"),component:"base-select",storeAction:"vendor/List",placeholder:"Select vendor",clearable:!0,emitValue:!0,key:"vendor"},{title:e.$t("label.category"),component:"base-select",placeholder:"Select category",storeAction:"category/List",clearable:!0,emitValue:!0,key:"category"},{title:e.$t("label.taggedWith"),component:"base-select",placeholder:"Select tag",storeAction:"tag/List",clearable:!0,emitValue:!0,key:"tag"},{title:e.$t("label.collection"),component:"base-select",placeholder:"Select collection",storeAction:"collection/List",clearable:!0,emitValue:!0,key:"collection"},{title:e.$t("label.status"),component:"base-select",dense:!0,outlined:!0,key:"status",placeholder:"Select status",optionsDense:!0,clearable:!0,emitValue:!0,options:["Active","Draft"]},{title:e.$t("label.sortBy"),component:"base-select",dense:!0,outlined:!0,key:"sortBy",optionsDense:!0,mapOptions:!0,emitValue:!0,style:"min-width: 200px",options:sortOptions(e)},{label:e.$t("label.trashed"),component:"q-checkbox",dense:!0,key:"deleted"}],hasVariant(e){return(t,o)=>e.rows?!!e.rows.filter(a=>a.options.find(l=>l.value===o&&l.position===t)).length:!1}},actions:{get(e){return new Promise((t,o)=>{g.post(`products/${e.product_id}/variants`,e).then(a=>{this.setRows(a.data),t(a)}).catch(a=>{o(a)})})},store(e){return new Promise((t,o)=>{g.post(`products/${e.product_id}/variants`,e).then(a=>{t(a)}).catch(a=>{o(a)})})},show(e){return new Promise((t,o)=>{g.get(`variants/${e.variant_id}`).then(a=>{t(a)}).catch(a=>{o(a)})})},update(e){return new Promise((t,o)=>{g.post(`variants/${e.id}`,e).then(a=>{t(a)}).catch(a=>{o(a)})})},delete(e){return new Promise((t,o)=>{g.delete(`variants/${e.variant_id}`).then(a=>{t(a)}).catch(a=>{o(a)})})},restore(e){return new Promise((t,o)=>{g.post(`variants/${e.variant_id}/restore`).then(a=>{t(a)}).catch(a=>{o(a)})})},changeList(e){return new Promise(async(t,o)=>{try{this.rows=e,t(this.rows)}catch(a){o(a)}})},generate(e){return new Promise((t,o)=>{try{const{is_gift_card:a}=e,l=f.exports.cloneDeep(e.default_variant);l.inventories=l.inventories.map(n=>(delete n.id,delete n.variant_id,n));const s=e.options.map(n=>n.values&&n.values.length?n.values.filter(r=>r.name).map(r=>r.name):[]).filter(n=>n.length);this.rows.length&&this.firstOrUpdate(e.options),s.length&&I.combinations(...s).filter(r=>!this.rows.find(m=>m.title===r.join(" / "))).forEach(r=>{var m=f.exports.cloneDeep(l);m.id=f.exports.uniqueId("v"),a&&(m.price=parseFloat(r.join("").substring(1))||0),m.title=r.join(" / "),m.create_on_save=!0,m.options=r.map((c,u)=>({id:!1,position:u,name:e.options[u].name,value:c})),this.pushRows(m)}),t(f.exports.cloneDeep(this.rows))}catch(a){o(a)}})},removeOption(e){return new Promise((t,o)=>{try{this.rows.forEach(a=>{if(a.options.find(l=>l.position===e.position)){a.options=a.options.filter(s=>s.position!==e.position).map((s,n)=>Object.assign(s,{position:n}));const l=a.options.map(s=>s.value).join(" / ");a.title=l,a.id=a.id?a.id:f.exports.uniqueId("v")}}),this.rows=f.exports.uniqBy(this.rows,"title"),t(this.rows)}catch(a){o(a)}})},removeOptionValue(e){return new Promise((t,o)=>{try{this.rows=this.rows.filter(a=>!a.options.find(l=>l.position===e.position&&l.value===e.value)),t(this.rows)}catch(a){o(a)}})},firstOrUpdate(e){this.rows.forEach(t=>{e.forEach((o,a)=>{if(o.values&&o.values.length&&!t.options.find(l=>l.position===a)){t.options.push({id:!1,position:a,name:o.name,value:o.values[0].name});const l=t.options.map(s=>s.value).join(" / ");t.title=l,t.id=t.id?t.id:f.exports.uniqueId("v")}})})},clear(e=[]){this.setRows(e),this.default=f.exports.cloneDeep(e)},edit(e){return new Promise((t,o)=>{try{const a=this.rows.find(l=>l.id===e.id);Object.assign(a,e),t(a)}catch(a){o(a)}})},remove(e){this.rows=this.rows.filter(t=>t.id!==e)}}}),H={props:{modelValue:[Number,String]},emits:["update:model-value"],data(){return{available:this.modelValue,quantity_update:0,quantity_update_type:"adjust",quantity_update_types:[{label:"Adjust",value:"adjust"},{label:"Replace",value:"replace"}]}}},M={class:"q-pa-md flex row"},F={class:"q-pa-md"},R={key:0,class:"text-subtitle2 q-mt-xs"},G={key:0,class:"q-ml-xs text-primary"},J={key:1,class:"q-ml-xs text-primary"},W={class:"q-ml-xs no-inventory"},K={key:1,class:"text-subtitle2 q-mt-xs"},X={class:"q-ml-xs"},Y={class:"q-pa-md text-right"},Z={class:"q-gutter-sm"};function ee(e,t,o,a,l,s){return v(),V(T,{"label-set":"Save",class:"q-pa-none",style:{width:"300px","max-width":"95vw"},"content-class":"base-popup-edit",modelValue:l.available,"onUpdate:modelValue":[t[2]||(t[2]=n=>l.available=n),t[4]||(t[4]=n=>e.$emit("update:model-value",n))],onBeforeShow:t[3]||(t[3]=n=>{l.quantity_update=0,l.quantity_update_type="adjust"})},{default:p(n=>[d("div",M,[i(U,{class:"text-subtitle1 text-weight-medium"},{default:p(()=>t[5]||(t[5]=[h(" Update quantity ")])),_:1})]),i(S),d("div",F,[i(D,{class:"q-mb-sm",inline:"",dense:"",modelValue:l.quantity_update_type,"onUpdate:modelValue":t[0]||(t[0]=r=>l.quantity_update_type=r),options:l.quantity_update_types},null,8,["modelValue","options"]),i(x,{type:"number",dense:"",modelValue:l.quantity_update,"onUpdate:modelValue":t[1]||(t[1]=r=>l.quantity_update=r),outlined:"",autofocus:""},null,8,["modelValue"]),l.quantity_update?(v(),_("div",R,[t[6]||(t[6]=d("span",null,"New quantity:",-1)),l.quantity_update_type==="replace"?(v(),_("span",G,b(l.quantity_update),1)):(v(),_("span",J,b(parseInt(l.quantity_update)+parseInt(n.value)),1)),d("span",W,b(n.value),1)])):(v(),_("div",K,[t[7]||(t[7]=d("span",null,"Original quantity:",-1)),d("span",X,b(n.value),1)]))]),i(S),d("div",Y,[d("div",Z,[i(w,{size:"12px",onClick:r=>n.cancel(),"no-caps":"",color:"grey",outline:"",label:e.$t("label.cancel")},null,8,["onClick","label"]),i(w,{size:"12px",onClick:r=>{n.value=l.quantity_update_type==="replace"?l.quantity_update:parseInt(l.quantity_update)+parseInt(n.value),n.set()},"no-caps":"",color:"positive",label:e.$t("label.save")},null,8,["onClick","label"])])])]),_:1},8,["modelValue"])}var te=q(H,[["render",ee]]);const le={props:{modelValue:{required:!0,type:Array}},data(){return{inventories:f.exports.cloneDeep(this.modelValue),default:f.exports.cloneDeep(this.modelValue)}},emits:["ok","hide"],methods:{show(){console.func("components/product/EditLocation:methods.show()",arguments),this.$refs.dialog.show()},hide(){console.func("components/product/EditLocation:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/product/EditLocation:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){this.$emit("ok",this.inventories),this.hide()}},computed:{hasInventory(){return this.inventories.filter(e=>e.active).length>0},disable(){return JSON.stringify(this.inventories)===JSON.stringify(this.default)||!this.hasInventory}}},ae={class:"q-gutter-sm"};function oe(e,t,o,a,l,s){const n=y("base-info"),r=y("base-dialog");return v(),V(r,{title:"Edit locations","body-class":"scroll",ref:"dialog",persistent:"","use-separator":"",onHide:s.onDialogHide},{body:p(()=>[s.hasInventory?$("",!0):(v(),V(n,{key:0,class:"q-mb-md"},{default:p(()=>t[0]||(t[0]=[h(" You must select at least one location for the variant. ")])),_:1})),t[1]||(t[1]=d("div",{class:"q-mb-md text-body2"}," Select locations that inventory the selected variants. ",-1)),i(O,{class:"q-gutter-sm"},{default:p(()=>[(v(!0),_(E,null,Q(l.inventories,(m,c)=>(v(),_("div",{key:c},[i(k,{size:"sm",dense:"",modelValue:m.active,"onUpdate:modelValue":u=>m.active=u,label:m.location.name},null,8,["modelValue","onUpdate:modelValue","label"])]))),128))]),_:1})]),footer:p(()=>[i(j,{class:"text-right"},{default:p(()=>[d("div",ae,[B(i(w,{"no-caps":"",outline:"",label:e.$t("label.cancel"),color:"grey"},null,8,["label"]),[[C]]),i(w,{disable:s.disable,"no-caps":"",label:e.$t("label.done"),color:"primary",onClick:s.onDone},null,8,["disable","label","onClick"])])]),_:1})]),_:1},8,["onHide"])}var ne=q(le,[["render",oe]]);const ie={components:{QuantityEditPopup:te},props:{modelValue:{required:!0,type:Object,default:()=>({})},flat:{type:Boolean,default:!1},creating:{type:Boolean,default:!1},title:{type:String,default:"Inventory"},description:String},emits:["update:model-value"],data(){return{inventory_columns_default:[{name:"available",creating:!0,label:"Available",field:"available",style:"width: 100px",align:"left"}],inventory_columns_multiple:[{name:"location",creating:!0,label:"Location name",field:e=>e.location.name,align:"left"},{name:"available",creating:!0,label:"Available",field:"available",style:"width: 100px"}],locations:[],variant:this.modelValue}},computed:{hasMultipleLocation(){return this.variant.inventories.length>1},inventory_columns(){return this.hasMultipleLocation?this.inventory_columns_multiple.filter(e=>this.creating&&e.creating||!this.creating):this.inventory_columns_default.filter(e=>this.creating&&e.creating||!this.creating)}},methods:{onEditLocation(e){console.func("components/product/InventorySection:method.onEditLocation()",arguments),this.$q.dialog({component:ne,componentProps:{modelValue:e}}).onOk(t=>{console.func("components/product/InventorySection:methods.onEditLocation.onOk()",arguments),this.variant.inventories=t})}},watch:{modelValue:{deep:!0,handler(e){this.variant=e}}}},se={class:"col-xs-12 col-sm-6"},re={class:"col-xs-12 col-sm-6"},ue={class:"col-xs-12 col-sm-12"},de={key:0},ce={class:"col-xs-12 col-sm-12"},pe={class:"text-label flex"},me={key:0,href:"javascript:void(0);",class:"text-primary"},ve={key:1,class:"text-grey"};function fe(e,t,o,a,l,s){const n=y("base-label"),r=y("base-btn"),m=y("quantity-edit-popup"),c=y("base-section");return v(),V(c,{flat:o.flat,title:o.title,description:o.description},{default:p(()=>[d("div",se,[i(n,null,{default:p(()=>[h(b(e.$t("label.skuStockKeepingUnit")),1)]),_:1}),i(x,{dense:"",outlined:"",modelValue:l.variant.sku,"onUpdate:modelValue":t[0]||(t[0]=u=>l.variant.sku=u)},null,8,["modelValue"])]),d("div",re,[i(n,null,{default:p(()=>[h(b(e.$t("label.barcodeIsbnUpcGtinEtc")),1)]),_:1}),i(x,{dense:"",outlined:"",modelValue:l.variant.barcode,"onUpdate:modelValue":t[1]||(t[1]=u=>l.variant.barcode=u)},null,8,["modelValue"])]),d("div",ue,[i(O,{class:"q-gutter-y-sm"},{default:p(()=>[d("div",null,[i(k,{size:"sm",dense:"",modelValue:l.variant.track_inventory,"onUpdate:modelValue":t[2]||(t[2]=u=>l.variant.track_inventory=u),label:e.$t("label.trackQuantity")},null,8,["modelValue","label"])]),l.variant.track_inventory?(v(),_("div",de,[i(k,{size:"sm",dense:"",modelValue:l.variant.out_of_stock_track_inventory,"onUpdate:modelValue":t[3]||(t[3]=u=>l.variant.out_of_stock_track_inventory=u),label:e.$t("label.continueSellingWhenOutOfInventory")},null,8,["modelValue","label"])])):$("",!0)]),_:1})]),d("div",ce,[d("div",pe,[t[5]||(t[5]=h(" Quantity ")),i(A),s.hasMultipleLocation?(v(),V(r,{key:0,link:"",padding:"0",color:"primary",label:e.$t("label.editLocations"),onClick:t[4]||(t[4]=u=>s.onEditLocation(l.variant.inventories))},null,8,["label"])):$("",!0)]),i(z,{class:"list-table",separator:s.hasMultipleLocation?"horizontal":"none",dense:!s.hasMultipleLocation,rows:l.variant.inventories.filter(u=>u.active===!0),columns:s.inventory_columns,"rows-per-page-options":[0],"hide-bottom":"",flat:"","row-key":"name"},{"body-cell-available":p(u=>[i(N,{props:u},{default:p(()=>[l.variant.track_inventory?(v(),_("a",me,[h(b(u.row.available)+" ",1),i(m,{modelValue:u.row.available,"onUpdate:modelValue":P=>u.row.available=P},null,8,["modelValue","onUpdate:modelValue"])])):(v(),_("span",ve,"Not tracked"))]),_:2},1032,["props"])]),_:1},8,["separator","dense","rows","columns"])])]),_:1},8,["flat","title","description"])}var Se=q(ie,[["render",fe]]);const be={props:{modelValue:{required:!0,type:Object},flat:{type:Boolean,default:!1},title:{type:String,default:"Pricing"},description:String},emits:["update:model-value"],data(){return{variant:this.modelValue,money:{decimal:".",separator:",",prefix:"$ ",precision:2,minimumFractionDigits:2,masked:!1,nullValue:0}}},watch:{modelValue:{deep:!0,handler(e){this.variant=e}}}},he={class:"col-xs-12 col-sm-6"},_e={class:"col-xs-12 col-sm-6"},ye={class:"col-xs-12 col-sm-6"},ge={class:"col-xs-12 col-sm-12"};function Ve(e,t,o,a,l,s){const n=y("base-label"),r=y("base-price-input"),m=y("base-section");return v(),V(m,{flat:o.flat,title:o.title,description:o.description},{default:p(()=>[d("div",he,[i(n,null,{default:p(()=>[h(b(e.$t("label.price")),1)]),_:1}),i(r,{modelValue:l.variant.price,"onUpdate:modelValue":[t[0]||(t[0]=c=>l.variant.price=c),t[1]||(t[1]=c=>e.$emit("update:model-value",l.variant))]},null,8,["modelValue"])]),d("div",_e,[i(n,null,{default:p(()=>[h(b(e.$t("label.compareAtPrice")),1)]),_:1}),i(r,{modelValue:l.variant.compare_at_price,"onUpdate:modelValue":[t[2]||(t[2]=c=>l.variant.compare_at_price=c),t[3]||(t[3]=c=>e.$emit("update:model-value",l.variant))]},null,8,["modelValue"])]),d("div",ye,[i(n,null,{default:p(()=>[h(b(e.$t("label.costPerItem")),1)]),_:1}),i(r,{modelValue:l.variant.cost_per_item,"onUpdate:modelValue":[t[4]||(t[4]=c=>l.variant.cost_per_item=c),t[5]||(t[5]=c=>e.$emit("update:model-value",l.variant))]},null,8,["modelValue"])]),d("div",ge,[i(k,{size:"sm",dense:"",modelValue:l.variant.taxable,"onUpdate:modelValue":[t[6]||(t[6]=c=>l.variant.taxable=c),t[7]||(t[7]=c=>e.$emit("update:model-value",l.variant))],label:e.$t("label.chargeTaxOnThisVariant")},null,8,["modelValue","label"])])]),_:1},8,["flat","title","description"])}var Oe=q(be,[["render",Ve]]);export{Se as I,Oe as P,$e as u};
