import{T as C,_ as v,d as r,o as s,f as c,e as g,w as d,j as y,ad as S,ag as P,h as i,g as _,t as b,U as V,S as B,Y as x,F as E,p as w,n as M,ar as T}from"./index.ec7eb99e.js";import{u as k,P as N}from"./PlanCard.3180e3c1.js";import{B as R}from"./BaseSectionSkeleton.971da8dd.js";const U={props:{modelValue:String,processing:Boolean,amount:Number,plan:{}},data(){return{visible:!0,promo:!1,promotion_code:null,errorMessage:null,hasError:!1,checking:!1,coupon:null}},emits:["update:processing","update:amount","update:model-value"],methods:{...C(k,["checkPromoCode"]),onRemoveCoupon(){console.func("components/ManageSubscription:methods.onRemoveCoupon()",arguments),this.coupon=null,this.promotion_code=null,this.promo=!1,this.errorMessage=null,this.hasError=!1,this.$emit("update:model-value",null),this.$emit("update:amount",this.amountToPay)},async onCheckPromoCode(){var o;console.func("components/ManageSubscription:methods.onCheckPromoCode()",arguments),this.hasError=!1,this.checking=!0,this.$emit("update:processing",!0),await this.checkPromoCode({promotion_code:this.promotion_code,plan_id:(o=this.plan)==null?void 0:o.id}).then(e=>{this.checking=!1,this.$emit("update:processing",!1),this.coupon=e}).catch(({message:e})=>{this.errorMessage=e,this.hasError=!0,this.checking=!1,this.$emit("update:processing",!1)}),this.$emit("update:model-value",this.promotion_code),this.$emit("update:amount",this.amountToPay)}},computed:{discount(){var o;if(this.coupon){const e=(o=this.plan)==null?void 0:o.price,{fixed:t,amount_off:m,percent_off:n}=this.coupon;return t?m>e?e:m:e*n/100}return 0},amountToPay(){var e;return((e=this.plan)==null?void 0:e.amount)-this.discount},formatedDiscount(){const{currency:o}=this.coupon||{};return o?this.$core.money(this.discount,{currency:o}):this.$core.money(this.discount)}},watch:{plan:{deep:!0,handler(){this.onRemoveCoupon()}}},mounted(){this.onRemoveCoupon()}},q={class:"coupon-card"},D={key:0,class:"q-my-md coupon-section"},A={key:1,class:"q-my-md coupon-section"},F={class:"text-bold q-px-xs"};function I(o,e,t,m,n,a){var l;const u=r("base-btn"),h=r("base-label"),f=r("base-input");return s(),c("div",q,[n.coupon?(s(),c("div",A,[e[3]||(e[3]=_("span",null,"Coupon:",-1)),_("span",F,b((l=n.coupon)==null?void 0:l.promotion_code),1),_("span",null,"(-"+b(a.formatedDiscount)+")",1),i(u,{onClick:a.onRemoveCoupon,link:"",color:"negative",class:"q-ml-xs",label:o.$t("label.x")},null,8,["onClick","label"])])):(s(),c("div",D,[n.promo?(s(),g(h,{key:1},{default:d(()=>e[2]||(e[2]=[y("Promo code")])),_:1})):(s(),g(u,{key:0,onClick:e[0]||(e[0]=p=>n.promo=!0),link:"",label:"Have a coupon code?"})),S(i(f,{placeholder:"Enter promo code",modelValue:n.promotion_code,"onUpdate:modelValue":e[1]||(e[1]=p=>n.promotion_code=p),type:"text","error-message":n.errorMessage,error:n.hasError,disable:n.checking},{after:d(()=>[i(u,{loading:n.checking,onClick:a.onCheckPromoCode,color:"grey",label:o.$t("label.apply")},null,8,["loading","onClick","label"])]),_:1},8,["modelValue","error-message","error","disable"]),[[P,n.promo]])]))])}var L=v(U,[["render",I]]);const O={components:{BaseSectionSkeleton:R,PlanCard:N},props:{modelValue:{},title:String,interval:String,noInterval:Boolean,col:{type:[String,Number],default:"6"},mode:String,disable:Boolean,loading:Boolean,dense:Boolean,options:Array},emits:["update:interval","update:model-value","update:mode"],methods:{onChange(o,e="create"){this.$emit("update:model-value",o),this.$emit("update:mode",e)}},computed:{...V(k,["plans"]),localOptions(){return(this.options||this.plans).filter(o=>o.is_active)}}};function $(o,e,t,m,n,a){const u=r("plan-card"),h=r("base-section-skeleton"),f=r("base-section");return s(),g(f,{dense:t.dense,flat:"",title:t.title},B({default:d(()=>[(s(!0),c(E,null,w(a.localOptions,(l,p)=>(s(),c("div",{key:p,class:M(`col-xs-12 col-sm-${t.col}`)},[i(u,T({flat:"",ref_for:!0},l,{"model-value":t.modelValue,"onUpdate:modelValue":a.onChange,disable:t.disable,dense:t.dense}),null,16,["model-value","onUpdate:modelValue","disable","dense"])],2))),128))]),_:2},[t.noInterval?void 0:{name:"action",fn:d(()=>[i(x,{dense:"","model-value":t.interval,"onUpdate:modelValue":e[0]||(e[0]=l=>o.$emit("update:interval",l)),"true-value":"year","false-value":"month",label:o.$t("yearly")},null,8,["model-value","label"])]),key:"0"},t.loading?{name:"skeleton",fn:d(()=>[i(h,{flat:"",bordered:""})]),key:"1"}:void 0]),1032,["dense","title"])}var Q=v(O,[["render",$]]);export{L as C,Q as P};
