import{_ as V,o as r,f as g,h as d,w as n,R as h,N as u,Q as p,W as P,j as y,t as _,e as c,Y as M,i as b,F as x,p as C,V as I}from"./index.ec7eb99e.js";const f=e=>e&&typeof e=="object"&&"access"in e?e.access:null,k={data(){return{dataModule:this.module,dataPermissions:this.modelValue}},emits:["update:model-value"],props:{module:{required:!0,type:Object},edit:{required:!1,type:Boolean,default:!0},modelValue:{required:!0,type:Array},groupPermissions:{required:!1,type:Array,default:()=>[]},hasIcon:Boolean},methods:{onToggle(e,s){console.func("components/PermissionsModule:methods.onToggle()",arguments);const t=this.dataPermissions.find(i=>i.id===s.id);t?e===null?this.dataPermissions.splice(this.dataPermissions.findIndex(i=>i.id===s.id),1):t.access=e:e!==null&&this.dataPermissions.push({id:s.id,access:e}),this.onChange()},async onToggleAll(e,s){console.func("components/PermissionsModule:methods.onToggleAll()",arguments);const t=e>0?1:e;await s.forEach(i=>{const o=this.dataPermissions.find(l=>l.id===i.id);o?o.access=t:t!==null&&this.dataPermissions.push({id:i.id,access:t})}),this.onProcess(),this.onChange()},getIcon(e){return this.hasIcon?e.group?"fas fa-users":"fas fa-user":""},getColor(e){return e.group?"warning":e.access?"positive":"negative"},getStatus(e){const s=this.groupPermissions.find(t=>t.id===e.id);return!!(s&&typeof s=="object"&&s.permission!==null)},onProcess(){this.dataModule.permissions=this.dataModule.permissions.map(e=>{const s=this.dataPermissions.find(i=>i.id===e.id),t=this.groupPermissions.find(i=>i.id===e.id);return{...e,user:f(s),group:f(t),access:f(Object.assign(s||{},t||{}))}})},onChange(){this.$emit("update:model-value",this.dataPermissions)}},mounted(){this.onProcess()},computed:{selected(){let e=0,s=0,t=this.dataModule.permissions;return t.forEach(i=>{const o=this.dataPermissions.find(a=>a.id===i.id),l=this.groupPermissions.find(a=>a.id===i.id);l?l.access===1?e++:l.access===0&&s++:o&&(o.access===1?e++:o.access===0&&s++)}),e===0&&s===0?null:s===t.length?0:t.length!==e?null:e},modulePermissions(){return this.dataModule.permissions.map(e=>e.id)},hasGroupPermission(){return this.groupPermissions.filter(e=>this.modulePermissions.includes(e.id)).length>0}},watch:{groupPermissions:{deep:!0,handler(){this.onProcess()}}}},v={class:"permission-modules"};function T(e,s,t,i,o,l){return r(),g("div",v,[d(I,{bordered:""},{default:n(()=>[d(h,{dense:"",class:"bg-grey-3"},{default:n(()=>[d(u,{style:{"min-width":"auto"},avatar:""},{default:n(()=>[d(p,{size:"xs",class:"text-primary",name:o.dataModule.icon},null,8,["name"])]),_:1}),d(u,null,{default:n(()=>[d(P,null,{default:n(()=>[y(_(o.dataModule.label),1)]),_:1})]),_:1}),t.edit?(r(),c(u,{key:0,side:""},{default:n(()=>[d(M,{size:"xs","toggle-indeterminate":"",modelValue:l.selected,"onUpdate:modelValue":[s[0]||(s[0]=a=>l.selected=a),s[1]||(s[1]=a=>l.onToggleAll(a,o.dataModule.permissions))],"false-value":0,"true-value":o.dataModule.permissions.length,color:"primary",disable:l.hasGroupPermission},null,8,["modelValue","true-value","disable"])]),_:1})):b("",!0)]),_:1}),(r(!0),g(x,null,C(o.dataModule.permissions,a=>(r(),c(h,{dense:"",key:a.id},{default:n(()=>[d(u,null,{default:n(()=>[d(P,null,{default:n(()=>[y(_(a.action),1)]),_:2},1024)]),_:2},1024),d(u,{side:""},{default:n(()=>[t.edit?(r(),c(M,{key:0,size:"xs","toggle-indeterminate":"",modelValue:a.access,"onUpdate:modelValue":[m=>a.access=m,m=>l.onToggle(m,a)],"true-value":1,"false-value":0,icon:l.getIcon(a),color:l.getColor(a),disable:l.getStatus(a)},null,8,["modelValue","onUpdate:modelValue","icon","color","disable"])):(r(),c(p,{key:1,size:"xs",name:a.access?"check":"close",color:l.getColor(a)},null,8,["name","color"]))]),_:2},1024)]),_:2},1024))),128))]),_:1})])}var w=V(k,[["render",T]]);export{w as P};
