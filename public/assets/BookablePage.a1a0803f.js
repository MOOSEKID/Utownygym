import{Q as P}from"./QTd.ce5eb0a5.js";import{Q as D}from"./QTr.4bf4ade2.js";import{Q as R}from"./QBanner.29df4abb.js";import{Q as S}from"./QPopupProxy.64b9fae0.js";import{_ as V,T as Y,m as z,U as j,d as w,o as n,e as y,w as o,h as t,j as b,t as i,i as C,f,p as Q,g as h,F as q,s as T,ae as v,ad as M,ag as L,R as F,N as O,W as E,ct as U}from"./index.ec7eb99e.js";import{Q as W}from"./QPage.b13c45b6.js";import{u as N}from"./class-schedule.9cf3b7cc.js";import{P as G}from"./PaymentConfirm.4a4c244a.js";import"./QMenu.76199ca9.js";import"./selection.571043d0.js";import"./PaymentMethodCard.b5da68e2.js";const{formatDate:J,addToDate:K}=U,A=(e=0)=>J(K(new Date,{days:e}),"YYYY-MM-DD"),X={data(){return{loading:!1,pagination:{sortBy:"date_at",otherSortBy:"start_at",descending:!1,page:1,filter:"",active:null,deleted:!1,rowsPerPage:15,rowsNumber:15,loaded:!1,date_from:A(),date_to:A(6)},rowsByDate:[]}},methods:{...Y(N,["get","book"]),onRequest(e){console.func("pages/pages/users/BookablePage:methods.onRequest()",arguments);const{page:s,rowsPerPage:g,sortBy:_,descending:d}=e.pagination;this.pagination=e.pagination,this.loading=!0,this.get({...e.pagination,direction:d?"desc":"asc"}).then(({data:l})=>{const p=z.exports.groupBy(l,r=>r.day);this.rowsByDate=Object.keys(p).map(r=>({id:r,day:`${r} (${p[r][0].date_at_formated})`,rows:p[r]})),this.pagination.page=s,this.pagination.rowsPerPage=g,this.pagination.sortBy=_,this.pagination.descending=d,this.pagination.loaded=!0,this.loading=!1}).catch(l=>{this.$core.error(l,{title:this.$t("dialog.title.error")})})},async toolbarClicked(e,s){console.func("pages/users/BookablePage:methods.toolbarClicked()",arguments)},async rowClicked(e,s){if(console.func("pages/users/BookablePage:methods.rowClicked()",arguments),!!s.bookable){if(s.has_booked){this.$core.warning(this.$t("dialog.info.noSlotAvailable"));return}if(s.is_booked){this.$core.warning(this.$t("dialog.info.userAlreadyBooked"));return}s.loading=!0,this.book(s).then(({payment:g})=>{if(g){const{amount:_}=g;this.$q.dialog({component:G,componentProps:{dueAmount:_,invoice:g,type:"order",message:`To confirm your booking, please complete payment of ${_}.`,redirect:this.$route.fullPath}}).onOk(async()=>{})}else s.is_booked=!0,s.loading=!1}).catch(()=>{s.loading=!1})}},onChangeDate(e){console.func("pages/users/BookablePage:methods.onChangeDate()",arguments),this.onRequest({pagination:{...this.pagination}})},getColor(e){return e.has_booked?"warning":e.bookable?"secondary":"negative"}},computed:{...j(N,["rows","columns","module","toolbar","filters"]),permissions(){return[]},hasBlocked(){return this.$app.user.has_blocked},blocked(){return this.$app.user.blocked}}},Z=["innerHTML"],x={key:0,class:"q-mt-sm"},ee=["href"],oe={class:"col-xs-12"},ae=["innerHTML"],te={key:0,class:"q-mt-sm"},se=["href"],ne={key:1};function le(e,s,g,_,d,l){const p=w("base-info"),r=w("base-label"),B=w("base-table"),H=w("base-btn"),I=w("base-section");return n(),y(W,{padding:""},{default:o(()=>[t(I,{flat:"",bordered:"",title:e.$t("dateRange",{from:e.$core.formatDate(d.pagination.date_from),to:e.$core.formatDate(d.pagination.date_to)}),"no-row":""},{default:o(()=>[t(B,{module:e.module,columns:[{name:"id",label:"Day",field:"day",align:"left",sortable:!1}],rows:d.rowsByDate,toolbar:e.toolbar,filters:e.filters,loading:d.loading,pagination:d.pagination,onRequest:l.onRequest,onToolbarClicked:l.toolbarClicked,"no-data-label":e.$t("registrations.noData"),"no-permissions":"","hide-pagination":"","hide-header":""},{"top-bottom":o(()=>[l.hasBlocked?(n(),y(p,{key:0,rounded:"",class:"q-mt-md"},{default:o(()=>[b(i(e.$t("blockedInfo",{release:e.$core.formatDateAsHuman(l.blocked.release_at)})),1)]),_:1})):C("",!0)]),body:o(c=>[t(D,{"no-hover":"",class:"day-header",props:c},{default:o(()=>[(n(!0),f(q,null,Q(c.cols,a=>(n(),y(P,{key:a.name,props:c},{default:o(()=>[h("span",null,i(a.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"]),t(D,{props:c},{default:o(()=>[t(P,{class:"q-pa-none",colspan:"100%"},{default:o(()=>[t(B,{columns:e.columns,rows:c.row.rows,"hide-top":"","hide-pagination":"","rows-per-page-options":[0],loaded:""},{actions:o(a=>{var m,k;return[(k=(m=a.row)==null?void 0:m.class)!=null&&k.has_description?(n(),y(T,{key:0,icon:"fad fa-circle-info",onClick:s[0]||(s[0]=v(()=>{},["stop"])),flat:"",size:"sm",round:""},{default:o(()=>[t(S,null,{default:o(()=>[t(R,{style:{width:"350px"}},{default:o(()=>[t(r,null,{default:o(()=>[b(i(e.$t("description")),1)]),_:1}),h("span",{innerHTML:e.$core.nl2br(a.row.class.description)},null,8,Z),a.row.class.urls?(n(),f("div",x,[t(r,null,{default:o(()=>[b(i(e.$t("urls")),1)]),_:1}),(n(!0),f(q,null,Q(a.row.class.urls,(u,$)=>(n(),f("div",{key:$},[h("a",{href:u.url},i(u.label||u.url),9,ee)]))),128))])):C("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)):C("",!0),M(t(T,{onClick:v(u=>l.rowClicked(a,a.row),["stop"]),size:"sm",round:"",flat:"",color:l.getColor(a.row),icon:`fas fa-calendar-circle-${a.row.is_booked?"user":"plus"}`,loading:a.row.loading},null,8,["onClick","color","icon","loading"]),[[L,a.row.bookable]])]}),_:2},1032,["columns","rows"])]),_:2},1024)]),_:2},1032,["props"])]),item:o(c=>[h("div",oe,[t(F,{class:"bg-grey-4"},{default:o(()=>[t(O,{avatar:""},{default:o(()=>[t(E,null,{default:o(()=>[b(i(c.row.day),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(D,null,{default:o(()=>[t(P,{class:"q-pa-none",colspan:"100%"},{default:o(()=>[t(B,{columns:e.columns,rows:c.row.rows,"hide-top":"","hide-pagination":"","rows-per-page-options":[0],loaded:"","has-actions":""},{"body-cell-class":o(a=>{var m,k;return[(k=(m=a.row)==null?void 0:m.class)!=null&&k.has_description?(n(),y(H,{key:0,link:"",label:a.value,onClick:s[1]||(s[1]=v(()=>{},["stop"]))},{default:o(()=>[t(S,null,{default:o(()=>[t(R,{style:{width:"350px"}},{default:o(()=>[t(r,null,{default:o(()=>[b(i(e.$t("description")),1)]),_:1}),h("span",{innerHTML:e.$core.nl2br(a.row.class.description)},null,8,ae),a.row.class.urls?(n(),f("div",te,[t(r,null,{default:o(()=>[b(i(e.$t("urls")),1)]),_:1}),(n(!0),f(q,null,Q(a.row.class.urls,(u,$)=>(n(),f("div",{key:$},[h("a",{href:u.url},i(u.label||u.url),9,se)]))),128))])):C("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"])):(n(),f("span",ne,i(a.value),1))]}),actions:o(a=>[M(t(T,{onClick:v(m=>l.rowClicked(a,a.row),["stop"]),size:"sm",round:"",flat:"",color:l.getColor(a.row),icon:`fas fa-calendar-circle-${a.row.is_booked?"user":"plus"}`,loading:a.row.loading},null,8,["onClick","color","icon","loading"]),[[L,a.row.bookable]])]),_:2},1032,["columns","rows"])]),_:2},1024)]),_:2},1024)])]),_:1},8,["module","rows","toolbar","filters","loading","pagination","onRequest","onToolbarClicked","no-data-label"])]),_:1},8,["title"])]),_:1})}var pe=V(X,[["render",le]]);export{pe as default};
