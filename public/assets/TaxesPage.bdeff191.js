import{_ as D,d as r,o as C,e as S,w as a,h as l,g as p,j as h,t as c,O as T,bt as P,A as g,ca as y,T as q,U as R,W as w,s as V,ae as v}from"./index.ec7eb99e.js";import{Q as U}from"./QPage.b13c45b6.js";import{S as H}from"./SettingsPageHeader.b1719c9d.js";import{C as O,S as Q}from"./StateSelect.d3ce42fc.js";import"./index.becf6c0c.js";const A={components:{CountrySelect:O,StateSelect:Q},props:{title:String,modelValue:{type:Object,default:()=>({})},method:Function},data(){return{tax:this.modelValue,loading:!1}},emits:["ok","hide"],methods:{async show(){console.func("components/shop/VariantDialog:methods.show()",arguments),this.tax=this.modelValue,this.$refs.dialog.show()},hide(){console.func("components/shop/VariantDialog:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/shop/VariantDialog:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/shop/VariantDialog:methods.onDone()",arguments),this.loading=!0,this.method(this.tax).then(({data:e})=>{this.$emit("ok",e),this.hide(),this.loading=!1}).catch(e=>{this.$core.error(e),this.loading=!1})}}},B={class:"col-xs-12 col-sm-4"},N={class:"col-xs-12 col-sm-4"},E={class:"col-xs-12 col-sm-4"},j={class:"col-xs-12 col-sm-3"},z={class:"col-xs-12 col-sm-3"},I={class:"col-xs-12 col-sm-12"};function F(e,t,i,s,o,u){const m=r("base-label"),f=r("country-select"),x=r("state-select"),b=r("base-input"),d=r("base-section"),_=r("base-dialog");return C(),S(_,{title:i.title,"body-class":"q-pa-none scroll",ref:"dialog",onHide:u.onDialogHide,onOk:u.onDone,"use-separator":"",persistent:"",loading:o.loading},{body:a(()=>[l(d,{flat:""},{default:a(()=>[p("div",B,[l(m,{required:""},{default:a(()=>[h(c(e.$t("label.country")),1)]),_:1}),l(f,{readonly:o.tax.removeable,modelValue:o.tax.country,"onUpdate:modelValue":t[0]||(t[0]=n=>o.tax.country=n),style:{width:"100%"},onComplete:t[1]||(t[1]=n=>o.tax.code=n.iso2)},null,8,["readonly","modelValue"])]),p("div",N,[l(m,{required:""},{default:a(()=>[h(c(e.$t("label.state")),1)]),_:1}),l(x,{readonly:o.tax.removeable,modelValue:o.tax.state,"onUpdate:modelValue":t[2]||(t[2]=n=>o.tax.state=n),country:o.tax.country,"option-value":"state_code",style:{width:"100%"}},null,8,["readonly","modelValue","country"])]),p("div",E,[l(m,{required:""},{default:a(()=>[h(c(e.$t("label.label")),1)]),_:1}),l(b,{debounce:"500",modelValue:o.tax.label,"onUpdate:modelValue":t[3]||(t[3]=n=>o.tax.label=n),style:{width:"100%"}},null,8,["modelValue"])]),p("div",j,[l(m,{required:""},{default:a(()=>[h(c(e.$t("label.rate")),1)]),_:1}),l(b,{modelValue:o.tax.rate,"onUpdate:modelValue":t[4]||(t[4]=n=>o.tax.rate=n),type:"number",min:"0",debounce:"500",style:{width:"100%"}},null,8,["modelValue"])]),p("div",z,[l(m,null,{default:a(()=>[h(c(e.$t("label.priority")),1)]),_:1}),l(b,{debounce:"500",modelValue:o.tax.priority,"onUpdate:modelValue":t[5]||(t[5]=n=>o.tax.priority=n),type:"number",min:"0"},null,8,["modelValue"])]),p("div",I,[l(T,{dense:"",modelValue:o.tax.compounded,"onUpdate:modelValue":t[6]||(t[6]=n=>o.tax.compounded=n),color:"green",label:e.$t("label.compounded")},null,8,["modelValue","label"])])]),_:1})]),_:1},8,["title","onHide","onOk","loading"])}var k=D(A,[["render",F]]);const $=P("taxes",{state:()=>({rows:[],permissions:{new:"settings:taxes",edit:"settings:taxes",delete:"settings:taxes"}}),getters:{columns:e=>[{name:"country",align:"left",label:e.$t("label.country"),field:"country",style:"width: 100px;",sortable:!0},{name:"state",align:"left",label:e.$t("label.state"),field:"state",style:"width: 50px;",sortable:!0},{name:"label",align:"left",label:e.$t("label.label"),field:"label",style:"width: 100px;",sortable:!0},{name:"rate",align:"center",label:e.$t("label.rate"),field:"rate",style:"width: 100px;",sortable:!0},{name:"compounded",align:"center",label:e.$t("label.compounded"),field:"compounded",format:t=>t?"Yes":"No",style:"width: 50px;",sortable:!0},{name:"priority",align:"center",label:e.$t("label.priority"),field:"priority",style:"width: 100px;",sortable:!0},{name:"actions",align:"right",sortable:!1}]},actions:{get(e){return new Promise((t,i)=>{g.get("taxes",e).then(s=>{const o=s.map(u=>({...u,removeable:u.code==="*"}));this.setRows(o),t(o)}).catch(s=>{i(s)})})},store(e){return new Promise((t,i)=>{g.post("taxes/store",e).then(s=>{t(s)}).catch(s=>{i(s)})})},update(e){return new Promise((t,i)=>{g.put(`taxes/${e.id}`,e).then(s=>{t(s)}).catch(s=>{i(s)})})},delete(e){return new Promise((t,i)=>{g.delete(`taxes/${e}/destroy`).then(s=>{this.deleteRows({id:e}),t(s)}).catch(s=>{i(s)})})},add(){y.create({component:k,componentProps:{title:this.$t("label.addTax"),method:this.store,modelValue:{country:null,code:null,state:"*",label:this.$t("label.vat"),rate:0,compounded:!1,priority:0}}}).onOk(e=>{this.pushRows(e)})},edit({row:e,pageIndex:t}){y.create({component:k,componentProps:{title:this.$t("label.updateTax"),method:this.update,modelValue:{...e}}}).onOk(i=>{this.editRows(i)})}}}),L={data(){return{loaded:!1}},methods:{...q($,["get","store","update","delete","add","edit"]),onEdit(e){console.func("components/settings/TaxesDialog:methods.onEdit()",arguments),this.edit(e)},onRemove({row:e}){console.func("components/settings/TaxesDialog:methods.onRemove()",arguments),this.$core.confirm("Are you sure you want to delete this tax?").then(()=>{this.delete(e==null?void 0:e.id)})}},computed:{...R($,["rows","columns"])},mounted(){this.get().then(()=>{this.loaded=!0}).catch(e=>{this.$core.error(e)})},components:{SettingsPageHeader:H}},M={class:"q-gutter-xs"};function W(e,t,i,s,o,u){const m=r("base-btn"),f=r("settings-page-header"),x=r("base-table"),b=r("base-section");return C(),S(U,{padding:""},{default:a(()=>[l(f,{class:"q-mb-md",title:"Taxes and duties","back-route":"Settings",hint:e.$t("hint.manageSalesTaxCollection")},{action:a(()=>[l(m,{label:e.$t("label.addTax"),onClick:e.add},null,8,["label","onClick"])]),_:1},8,["hint"]),l(b,{flat:"",bordered:"","no-row":""},{default:a(()=>[l(x,{ref:"taxes",columns:e.columns,rows:e.rows,"hide-top":"","hide-pagination":"","rows-per-page-options":[0],loaded:o.loaded,"has-actions":""},{"section-body":a(d=>[l(w,{class:"q-mb-xs"},{default:a(()=>[h(c(d.row.country)+" ("+c(d.row.state)+") ",1)]),_:2},1024),l(w,{caption:""},{default:a(()=>[h(c(d.row.label)+" - "+c(d.row.rate)+"% ",1)]),_:2},1024)]),actions:a(d=>[p("div",M,[l(V,{onClick:v(_=>u.onEdit(d),["stop"]),size:"sm",round:"",flat:"",color:"warning",icon:"fas fa-edit"},null,8,["onClick"]),l(V,{onClick:v(_=>u.onRemove(d),["stop"]),size:"sm",round:"",flat:"",color:"grey",icon:"fas fa-trash-can",disable:d.row.removeable},null,8,["onClick","disable"])])]),_:1},8,["columns","rows","loaded"])]),_:1})]),_:1})}var Z=D(L,[["render",W]]);export{Z as default};
