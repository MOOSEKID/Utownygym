import{_ as H,m as d,T as C,U as F,u as O,d as i,c8 as W,o as r,e as p,w as o,g as u,h as s,S,O as G,ad as J,t as c,W as D,j as h,i as b,f,F as y,R as P,N as v,p as x,ar as K}from"./index.ec7eb99e.js";import{Q as X}from"./QTimeline.c279b714.js";import{Q as Y}from"./QPage.b13c45b6.js";import{S as Z}from"./SkeletonSinglePage.dba71dd3.js";import{u as $}from"./enquiry.b5f57f80.js";import{u as ee}from"./member.8ccf3331.js";import{P as te}from"./ProductsCard.75cab0ba.js";import{R as se}from"./ReplyCard.2946e011.js";import{P as oe}from"./mixins.af528ab3.js";import"./QSkeleton.73bc54f6.js";import"./QBadge.f11b4156.js";import"./QTd.ce5eb0a5.js";import"./QTable.e99aec6c.js";import"./QMarkupTable.22b5d641.js";import"./QSelect.ad394656.js";import"./QField.ad3f8f9a.js";import"./QChip.cb7fa0e0.js";import"./QMenu.76199ca9.js";import"./selection.571043d0.js";import"./rtl.276c3f1b.js";import"./QTr.4bf4ade2.js";import"./index.22ce7155.js";import"./tag.6f04df2c.js";import"./category.83d9548f.js";import"./collection.5ec0fec2.js";import"./AddDiscount.6731a85e.js";import"./FileSelectorDialog.014f4c1d.js";import"./StateSelect.d3ce42fc.js";import"./index.becf6c0c.js";import"./CitySelect.367b922a.js";import"./BaseSectionSkeleton.971da8dd.js";import"./page.e7247b54.js";import"./QExpansionItem.38c12bfd.js";import"./QSlideTransition.d1b840b3.js";const E={media:[],message:"",status:"Pending",is_archived:!1,user_archived:!1},ae={mixins:[oe],components:{SkeletonSinglePage:Z,ProductsCard:te,ReplyCard:se},data(){return{defaultData:d.exports.cloneDeep(E),formData:d.exports.cloneDeep(E)}},methods:{...C($,["store","show","update","delete","reply","changeArchived","changeUserArchived"]),...C(ee,{getMember:"options",getUser:"show",getUsers:"shows"}),onSubmit(e){console.func("pages/core/enquiries/EnquiryPage:methods.onSubmit()",arguments),this.submited=!0,(this.creating?this.store:this.update)({...this.formData,admin:this.isAdmin}).then(({data:_,message:k})=>{if(this.submited=!1,this.$q.notify(k),this.formData.bulk)return this.defaultData=d.exports.cloneDeep(this.formData),this.$router.back(),!1;this.formData=_,this.defaultData=d.exports.cloneDeep(_),this.$router.push({name:"Enquiry",params:{id:_.id},query:{action:"edit",title:_.subject}})}).catch(_=>{this.submited=!1,this.$core.error(_,{title:this.$t("dialog.title.error")})})},onDelete(e){console.func("pages/core/enquiries/EnquiryPage:methods.onDelete()",arguments),this.$core.confirm(this.$t("dialog.info.warning")).then(()=>{this.delete(this.id).then(()=>{this.$router.push({name:"Enquiries"})}).catch(a=>{this.$core.error(a,{title:this.$t("dialog.title.error")})})})},onCreateNote(e){console.func("pages/core/enquiries/EnquiryPage:methods.onCreateNote()",arguments),e?(this.formData.replies.splice(0,0,d.exports.cloneDeep(e)),this.defaultData.replies.splice(0,0,d.exports.cloneDeep(e))):this.show(this.id).then(a=>{this.formData=a,this.defaultData=d.exports.cloneDeep(a)})},onUpdateArchived(){console.func("pages/core/enquiries/EnquiryPage:methods.onUpdateArchived()",arguments),(this.isAdmin?this.changeArchived:this.changeUserArchived)(this.formData).then(()=>{this.defaultData=d.exports.cloneDeep(this.formData)})}},async mounted(){this.creating?(this.user?await this.getUser(this.user).then(e=>{this.formData.user={name:e.name,email:e.email,id:e.id},this.defaultData=d.exports.cloneDeep(this.formData)}):this.users&&await this.getUsers({ids:this.users.split(",")}).then(e=>{this.formData.bulk=!0,this.formData.user=e.map(a=>({name:a.name,email:a.email,id:a.id})),this.defaultData=d.exports.cloneDeep(this.formData)}),this.loaded=!0):this.show(this.id).then(e=>{this.$app.setTitle(e.subject||"Contact us"),this.formData=e,this.defaultData=d.exports.cloneDeep(e),this.loaded=!0}).catch(e=>{this.$emit("error",e)})},computed:{...F(O,["guard"]),user(){return this.$route.query.user},users(){return this.$route.query.users},isAdmin(){return this.guard==="admins"},archived(){return this.isAdmin?this.formData.is_archived:this.formData.user_archived},title(){return this.creating?this.$t("generalInformation"):this.formData.subject||this.$t("contactUs")}}},re={class:"q-gutter-md"},ie={class:"text-h6"},le={class:"col-xs-12"},ne={key:0,class:"col-xs-12"},me={class:"col-xs-12 col-sm-12"},de={class:"col-xs-12 col-sm-12"},ue={key:1,class:"col-xs-12"},ce={class:"row"},pe={key:0,class:"col-xs-12 col-sm-12"},he={key:1,class:"col-xs-12 col-sm-12"},fe={class:"col-xs-12 col-sm-12"},be=["innerHTML"],_e={key:2,class:"col-xs-12"},De={class:"files"},ge={class:"row q-col-gutter-sm"};function ve(e,a,_,k,t,n){const j=i("base-status"),g=i("base-label"),N=i("base-input"),Q=i("base-select"),M=i("base-editor"),R=i("base-dropzone"),q=i("base-avatar"),T=i("base-media-card"),V=i("base-btn"),U=i("base-section"),z=i("products-card"),A=i("reply-card"),B=i("base-form"),I=i("skeleton-single-page"),L=W("guard");return r(),p(Y,{padding:""},{default:o(()=>[e.loaded?(r(),p(B,{key:0,onSubmit:n.onSubmit,onCancel:e.onCancel,onReset:e.onReset,resetable:e.resetable,disable:e.disable,submited:e.submited,"no-action":!e.creating,"save-label":e.$t("send")},{default:o(()=>{var w;return[u("div",re,[s(U,{flat:"",bordered:"","head-class":"q-pb-sm"},S({title:o(()=>[u("div",null,[u("div",ie,c(n.title),1),e.creating?b("",!0):(r(),p(D,{key:0},{default:o(()=>[h(c(e.$core.formatDateAsHuman(t.formData.created_at))+" ",1),s(j,{type:t.formData.status},null,8,["type"])]),_:1}))])]),default:o(()=>{var m;return[e.creating?(r(),f(y,{key:0},[u("div",le,[s(g,{required:""},{default:o(()=>[h(c(e.$t("subject")),1)]),_:1}),s(N,{modelValue:t.formData.subject,"onUpdate:modelValue":a[0]||(a[0]=l=>t.formData.subject=l),name:"subject"},null,8,["modelValue"])]),n.isAdmin?(r(),f("div",ne,[s(g,{required:""},{default:o(()=>[h(c(e.$t("label.user")),1)]),_:1}),s(Q,{placeholder:e.$t("placeholder.selectMember"),dense:"",outlined:"",modelValue:t.formData.user,"onUpdate:modelValue":a[1]||(a[1]=l=>t.formData.user=l),name:"user","filter-method":e.getMember,"map-options":"",multiple:t.formData.bulk,"use-filter":"","use-chips":"","cache-key":"users","option-label":l=>`${l.name} (${l.email})`},null,8,["placeholder","modelValue","filter-method","multiple","option-label"])])):b("",!0),u("div",me,[s(g,{required:""},{default:o(()=>[h(c(e.$t("label.message")),1)]),_:1}),s(M,{modelValue:t.formData.message,"onUpdate:modelValue":a[2]||(a[2]=l=>t.formData.message=l),name:"message"},null,8,["modelValue"])]),u("div",de,[s(g,null,{default:o(()=>[h(c(e.$t("attachment")),1)]),_:1}),s(R,{modelValue:t.formData.media,"onUpdate:modelValue":a[3]||(a[3]=l=>t.formData.media=l),name:"media"},null,8,["modelValue"])])],64)):(r(),f("div",ue,[u("div",ce,[n.isAdmin?(r(),f("div",pe,[s(P,{class:"q-px-none"},{default:o(()=>[s(v,{avatar:""},{default:o(()=>[s(q,{size:"45px",user:n.user||{name:t.formData.name}},null,8,["user"])]),_:1}),s(v,null,{default:o(()=>[s(D,{class:"text-subtitle2"},{default:o(()=>[h(c(t.formData.name)+" - "+c(t.formData.email),1)]),_:1}),t.formData.phone?(r(),p(D,{key:0},{default:o(()=>[h(c(t.formData.phone),1)]),_:1})):b("",!0)]),_:1})]),_:1})])):(m=t.formData)!=null&&m.admin?(r(),f("div",he,[s(P,{class:"q-px-none"},{default:o(()=>[s(v,{avatar:""},{default:o(()=>[s(q,{size:"45px",user:t.formData.admin},null,8,["user"])]),_:1}),s(v,null,{default:o(()=>[s(D,{class:"text-subtitle2"},{default:o(()=>[h(c(t.formData.name),1)]),_:1}),t.formData.phone?(r(),p(D,{key:0},{default:o(()=>[h(c(t.formData.email),1)]),_:1})):b("",!0)]),_:1})]),_:1})])):b("",!0),u("div",fe,[u("span",{innerHTML:t.formData.message},null,8,be)])])])),!e.creating&&t.formData.media.length?(r(),f("div",_e,[u("div",De,[u("div",ge,[(r(!0),f(y,null,x(t.formData.media,l=>(r(),f("div",{key:l.id,class:"col-sm-2 col-xs-12"},[s(T,{media:l},null,8,["media"])]))),128))])])])):b("",!0)]}),_:2},[e.creating?void 0:{name:"bottom",fn:o(()=>[s(G,{"model-value":n.archived,"onUpdate:modelValue":n.onUpdateArchived,label:e.$t("archived"),color:"warning",dense:""},null,8,["model-value","onUpdate:modelValue","label"]),J(s(V,{class:"q-ml-md",color:"negative",icon:"fas fa-trash-can",onClick:n.onDelete,label:e.$t("delete"),link:""},null,8,["onClick","label"]),[[L,void 0,"admins"]])]),key:"0"}]),1024),(w=t.formData)!=null&&w.order?(r(),p(z,{key:0,flat:"",bordered:"",view:"",modelValue:t.formData.order.line_items,"onUpdate:modelValue":a[4]||(a[4]=m=>t.formData.order.line_items=m),currency:t.formData.order.currency},S({_:2},[n.isAdmin?{name:"bottom",fn:o(()=>{var m;return[s(V,{link:"",label:"View order",to:`/admin/orders/${(m=t.formData)==null?void 0:m.order_id}`},null,8,["to"])]}),key:"0"}:void 0]),1032,["modelValue","currency"])):b("",!0),e.creating?b("",!0):(r(),p(U,{key:1,flat:"",bordered:"",title:e.$t("activities"),description:e.$t("enquiries.activityDesc"),"no-row":"","body-class":"q-px-lg"},{default:o(()=>[s(X,{class:"comments",color:"secondary"},{default:o(()=>[s(A,{creating:"",class:"comment","module-id":t.formData.id,"reply-method":e.reply,onCreate:n.onCreateNote,"is-admin":n.isAdmin,"onUpdate:archived":n.onUpdateArchived},null,8,["module-id","reply-method","onCreate","is-admin","onUpdate:archived"]),(r(!0),f(y,null,x(t.formData.replies,m=>(r(),p(A,K({class:"comment",key:m.id,ref_for:!0},m,{"module-id":t.formData.id,user:m.user}),null,16,["module-id","user"]))),128))]),_:1})]),_:1},8,["title","description"]))])]}),_:1},8,["onSubmit","onCancel","onReset","resetable","disable","submited","no-action","save-label"])):(r(),p(I,{key:1}))]),_:1})}var tt=H(ae,[["render",ve]]);export{tt as default};
