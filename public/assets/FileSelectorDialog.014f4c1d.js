import{T as D,cI as q,_ as C,d as y,o as s,e as x,w as r,h as t,aw as Q,f as i,F as u,j as z,t as g,i as p,g as d,as as m,av as U,p as k,at as _,au as S,Q as v,s as h,n as B,ck as L,cl as R,al as V,aq as j,ad as H,af as N}from"./index.ec7eb99e.js";const T={data(){return{selected:this.modelValue,files:this.relatedFiles,current_page:1,last_page:1,loading:!1}},props:{modelValue:{required:!1},relatedFiles:{required:!1,type:[Array],default:()=>[]},hint:[String],title:{type:[String],default:"uploadMedia"},multiple:Boolean,maxFileSize:{type:[Number,String],default:void 0},acceptType:{required:!1,type:[String],default:void 0},loadFromServer:Boolean,onUploading:{type:[Function],required:!1,default:void 0}},emits:["ok","hide"],methods:{...D(q,["get"]),onRejected(e){console.func("components/FileSelectorDialog:methods.onRejected()",arguments),this.$q.notify({type:"negative",message:`${e.length} file(s) did not pass validation constraints`})},onUploaded({files:e,xhr:l}){console.func("components/FileSelectorDialog:methods.onUploaded()",arguments),this.$refs.uploader.removeFile(e[0]);const a=JSON.parse(l.response);this.files.splice(0,0,a)},onLoadFile(e){console.func("components/FileSelectorDialog:methods.onLoadFile()",arguments),this.loading=!0,this.current_page=e.page,this.get(e).then(({data:l,meta:a})=>{this.files=l,this.current_page=a.current_page,this.last_page=a.last_page,this.loading=!1}).catch(()=>{this.loading=!1})},async show(){console.func("components/FileSelectorDialog:methods.show()",arguments),this.loadFromServer&&await this.onLoadFile({page:this.current_page}),this.$refs.dialog.show()},hide(){console.func("components/FileSelectorDialog:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/FileSelectorDialog:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/FileSelectorDialog:methods.onDone()",arguments),this.$emit("ok",this.selected),this.hide()},onSelect(e){console.func("components/file-selector-dialog.vue:methods.onSelect()",arguments),this.multiple?this.selected?this.selected.find(l=>l.id===e.id)?this.selected=this.selected.filter(l=>l.id!==e.id):this.selected.push(e):(this.selected=[],this.selected.push(e)):this.selected=this.selected&&this.selected.id===e.id?"":e},getSelected(e){return this.multiple?this.selected&&this.selected.filter(l=>l.id===e.id).length>0:this.selected&&this.selected.id===e.id}},computed:{headers(){return[{name:"Authorization",value:`Bearer ${this.$app.token}`}]},url(){return this.$core.apiBaseURL("/files/store")},disable(){return this.selected===this.modelValue}}},A={class:"file-grid"},I={class:"relative-position file-box file-select-btn"},O={class:"text-black flex flex-center"},E={class:"text-center"},J={class:"text-subtitle2 text-primary"},M={key:0,class:"q-pa-md text-black flex flex-center"},P={key:0,class:"thumbnail"},G={key:1,class:"q-pa-md text-black flex flex-center file"},K={class:"info overflow-hidden text-center"},W={key:2,class:"absolute-full q-pa-md text-black flex flex-center failed"},X={class:"info overflow-hidden text-center"},Y=["onClick"],Z={key:0,class:"thumbnail"},$={key:1,class:"q-pa-md text-black flex flex-center file"},ee={class:"info overflow-hidden text-center"},te={class:"absolute-full controller"},le={class:"q-pt-xs q-pr-sm absolute-top-right"},se={class:"q-gutter-sm"};function oe(e,l,a,ie,o,c){const F=y("base-info"),w=y("base-dialog");return s(),x(w,{title:e.$t(a.title),"body-style":"","body-class":"q-pa-none",ref:"dialog",persistent:"","use-separator":"",onHide:c.onDialogHide},{body:r(()=>[t(Q,{ref:"uploader",class:"full-width file-selector-dialog-uploader overflow-hidden",flat:"",multiple:a.multiple,"max-file-size":a.maxFileSize,"field-name":"media","auto-upload":"",accept:a.acceptType,headers:c.headers,url:c.url,onUploaded:c.onUploaded,onRejected:c.onRejected},{header:r(()=>l[2]||(l[2]=[])),list:r(f=>[o.loading?p("",!0):(s(),i(u,{key:0},[a.hint?(s(),x(F,{key:0,class:"q-mb-md"},{default:r(()=>[z(g(a.hint),1)]),_:1})):p("",!0),d("div",A,[d("div",I,[t(m,{class:"cursor-pointer file-selector-dialog min",ratio:1},{default:r(()=>[t(U),d("div",O,[d("div",E,[d("div",J,g(e.$t("browseFiles")),1),d("div",null,g(e.$t("orDropFilesHereToUpload")),1)])])]),_:1})]),(s(!0),i(u,null,k(f.files,(n,b)=>(s(),i("div",{class:"relative-position file-box",key:b},[t(m,{class:"box rounded-borders cursor-pointer bg-grey-4",ratio:1},{default:r(()=>[n.__status==="uploading"?(s(),i("div",M,[t(_,{color:"primary",size:"3rem",thickness:5})])):(s(),i(u,{key:1},[n.__img?(s(),i("div",P,[t(S,{src:n.__img.src,contain:""},{loading:r(()=>[t(_,{color:"white"})]),_:2},1032,["src"])])):(s(),i("div",G,[d("div",K,[t(v,{name:`fas fa-file-${n.icon}`,size:"50px"},null,8,["name"])])])),n.__status==="failed"?(s(),i("div",W,[d("div",X,[t(h,{flat:"",round:"",color:"white",icon:"fas fa-cloud-upload-alt",onClick:f.upload},null,8,["onClick"])])])):p("",!0)],64))]),_:2},1024)]))),128)),(s(!0),i(u,null,k(o.files,n=>(s(),i("div",{onClick:b=>c.onSelect(n),class:B({"relative-position":!0,"file-box":!0,selected:c.getSelected(n)}),key:n.id},[t(m,{class:"box rounded-borders cursor-pointer",ratio:1},{default:r(()=>[n.is_image?(s(),i("div",Z,[t(S,{src:n.url,contain:""},{loading:r(()=>[t(_,{color:"white"})]),_:2},1032,["src"])])):(s(),i("div",$,[d("div",ee,[t(v,{name:`fas fa-file-${n.icon}`,size:"50px"},null,8,["name"])])])),d("div",te,[d("div",le,[t(v,{class:"checked-icon",size:"15px",color:"green",name:"fas fa-check-circle"})])])]),_:2},1024)],10,Y))),128))])],64)),t(L,{showing:o.loading},{default:r(()=>[t(R,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1},8,["multiple","max-file-size","accept","headers","url","onUploaded","onRejected"])]),footer:r(()=>[t(V,{class:"flex"},{default:r(()=>[a.loadFromServer?(s(),i(u,{key:0},[t(h,{disable:o.current_page<=1||o.loading,onClick:l[0]||(l[0]=f=>c.onLoadFile({page:o.current_page-1>=1?o.current_page-1:1})),dense:"",round:"",flat:"",color:"primary",icon:"fal fa-angle-left"},null,8,["disable"]),t(h,{disable:o.current_page==o.last_page||o.loading,onClick:l[1]||(l[1]=f=>c.onLoadFile({page:o.current_page+1<=o.last_page?o.current_page+1:1})),dense:"",round:"",flat:"",color:"primary",icon:"fal fa-angle-right"},null,8,["disable"])],64)):p("",!0),t(j),d("div",se,[H(t(h,{"no-caps":"",outline:"",label:e.$t("cancel"),color:"grey"},null,8,["label"]),[[N]]),t(h,{disable:c.disable,"no-caps":"",label:e.$t("done"),color:"primary",onClick:c.onDone},null,8,["disable","label","onClick"])])]),_:1})]),_:1},8,["title","onHide"])}var ne=C(T,[["render",oe]]);export{ne as F};
