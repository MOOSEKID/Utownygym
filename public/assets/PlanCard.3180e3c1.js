import{bt as f,A as a,U as g,_ as P,o as h,e as m,w as o,h as d,al as v,R as w,N as S,W as b,n as y,g as c,t as p,aq as C,f as _,F as M,p as L,i as I,ai as k}from"./index.ec7eb99e.js";const x=f("subscription",{state:()=>({isLoadingSubscription:!0,user:null,subscription:{upcomingInvoice:null,plan:null},paymentMethods:[],invoices:[],plans:[]}),getters:{payload(e){var t;return{user_id:(t=e.user)==null?void 0:t.id}},defaultPaymentMethod(e){return e.paymentMethods.find(t=>t.is_default)},upcomingInvoice(e){return e.subscription.upcomingInvoice},hasDue(e){var t;return(t=e.subscription)==null?void 0:t.hasDue},dueAmount(e){var t,s;return(s=(t=e.subscription)==null?void 0:t.invoice)==null?void 0:s.amount},invoice(e){var t;return(t=e.subscription)==null?void 0:t.invoice},currentPlan(e){const{plan:t}=e.subscription;return t||null},noPaymentMethods(e){return(e==null?void 0:e.paymentMethods.length)<=0},selectedPlan(e){return t=>e.plans.find(s=>s.id===t)},defaultPlan(e){const t=e.plans[0];return t||null},subscribed(e){var t;return(t=e.subscription)==null?void 0:t.is_valid},canceled(e){var t;return(t=e.subscription)==null?void 0:t.canceled},ended(e){var t;return(t=e.subscription)==null?void 0:t.ended},billingDetails(e){const t=e.user,{line1:s,line2:n,city:r,state:i,postal_code:u}=t.address||{};return{name:t.name,email:t.email,phone:t.phone_number,address:{line1:s,line2:n,city:r,state:i,postal_code:u}}},usages(e){var t;return((t=e.subscription)==null?void 0:t.usages)||[]}},actions:{getPlans(e={}){var s;const t=(s=this.currentPlan)==null?void 0:s.id;return new Promise((n,r)=>{a.get("shared/plans",{...e,plan_id:t}).then(i=>{const u=Array.isArray(i)?i:[];this.plans=u.map(l=>({...l,features:l.feature_lines,value:l.id})),n(i)}).catch(i=>{r(i)})})},subscribe(e){return new Promise((t,s)=>{a.post("subscription/subscribe",{...e,...this.payload}).then(n=>{t(n)}).catch(n=>{s(n)})})},loadSubscription(){return this.isLoadingSubscription=!0,new Promise(async(e,t)=>{a.get("subscription",this.payload).then(async s=>{this.subscription=s,await this.getPlans(),this.isLoadingSubscription=!1,e(s)}).catch(s=>{this.isLoadingSubscription=!1,t(s)})})},pay(e={}){return new Promise((t,s)=>{a.post("subscription/pay",{...e,...this.payload}).then(n=>{t(n)}).catch(n=>{s(n)})})},confirm(e){return new Promise((t,s)=>{a.post("subscription/confirm",{...e,...this.payload}).then(n=>{t(n)}).catch(n=>{s(n)})})},cancel(){return new Promise((e,t)=>{a.post("subscription/cancel",this.payload).then(async s=>{this.updateCancelled(!0),await this.loadSubscription(),e(s)}).catch(s=>{t(s)})})},cancelDowngrade(){return new Promise((e,t)=>{a.post("subscription/cancel-downgrade",this.payload).then(async s=>{await this.loadSubscription(),e(s)}).catch(s=>{t(s)})})},resume(){return new Promise((e,t)=>{a.post("subscription/resume",this.payload).then(async s=>{this.updateCancelled(!1),await this.loadSubscription(),e(s)}).catch(s=>{t(s)})})},getInvoices(e){return new Promise((t,s)=>{a.post("subscription/invoices",{...e,...this.payload}).then(n=>{this.invoices=n.data,t(n)}).catch(n=>{s(n)})})},downloadInvoice(e){return new Promise((t,s)=>{a.download(`subscription/invoices/${e}`,this.payload).then(n=>{t(n)}).catch(n=>{s(n)})})},getPaymentMethods(){return new Promise((e,t)=>{a.post("users/payment-methods",this.payload).then(s=>{const n=Array.isArray(s)?s:[];this.paymentMethods=n.map(r=>({...r,id:r.stripe_id,pId:r.id})),e(this.paymentMethods)}).catch(s=>{t(s)})})},addPaymentMethod(e){return new Promise((t,s)=>{a.post("users/payment-methods/store",{...e,...this.payload}).then(async n=>{await this.getPaymentMethods(),t(n)}).catch(n=>{s(n)})})},removePaymentMethod(e){return new Promise((t,s)=>{a.delete(`users/payment-methods/${e}`,this.payload).then(async n=>{await this.getPaymentMethods(),t(n)}).catch(n=>{s(n)})})},updateDefaultPaymentMethod(e){return new Promise((t,s)=>{a.post(`users/payment-methods/${e}/update`,this.payload).then(async n=>{await this.getPaymentMethods(),t(n)}).catch(n=>{s(n)})})},checkPromoCode(e){return new Promise((t,s)=>{a.post("subscription/check-promo-code",e).then(async n=>{t(n)}).catch(n=>{s(n)})})},async setUser(e,t=!1){const{id:s}=this.user||{};this.user=e,(s!==(e==null?void 0:e.id)||t)&&await this.loadSubscription()},removeUser(){this.user=null,this.isLoadingSubscription=!0},updateCancelled(e){this.subscription&&(this.subscription.has_cancelled=e)}}});const A={props:{id:[Number,String],modelValue:{},label:String,features:{type:Array,default:()=>[]},interval:String,interval_count:[String,Number],price_formated:String,price:[String,Number],disable:Boolean,dense:Boolean},emits:["update:model-value"],methods:{onChange(){var s;if(this.disable||this.current)return!1;const e=(s=this.currentPlan)!=null&&s.id?"change":"create",t={...this.$props,feature_lines:this.features};this.$emit("update:model-value",t,e)}},computed:{...g(x,["currentPlan"]),current(){var e;return this.id===((e=this.currentPlan)==null?void 0:e.id)},selected(){var e;return((e=this.modelValue)==null?void 0:e.id)===this.id},intervalLabel(){return this.$core.priceToInterval(this.$props,!1,!0)}},watch:{interval(){this.selected&&this.onChange()}}},N={class:"name text-subtitle2"},B={class:"text-grey price"},D={class:"text-subtitle2"},Q={class:"features"},V=["innerHTML"];function T(e,t,s,n,r,i){return h(),m(k,{class:y({"plan-card cursor-pointer":!0,"current bg-secondary":i.current&&(!s.disable||!s.dense),selected:i.selected}),onClick:i.onChange},{default:o(()=>[d(v,null,{default:o(()=>[d(w,{class:"q-pa-none"},{default:o(()=>[d(S,null,{default:o(()=>[d(b,{class:y({flex:!s.dense})},{default:o(()=>[c("div",N,p(s.label),1),d(C),c("div",B,[c("span",D,p(s.price_formated),1),c("span",null,p(i.intervalLabel),1)])]),_:1},8,["class"]),s.dense?I("",!0):(h(),m(b,{key:0},{default:o(()=>[c("div",Q,[c("ul",null,[(h(!0),_(M,null,L(s.features,(u,l)=>(h(),_("li",{key:l},[c("span",{innerHTML:u},null,8,V)]))),128))])])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["class","onClick"])}var q=P(A,[["render",T]]);export{q as P,x as u};
