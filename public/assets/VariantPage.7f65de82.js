import{Q as B}from"./QSelect.ad394656.js";import{_ as J,cr as T,m as l,T as S,d as r,o as d,e as p,w as o,g as u,h as t,f as _,p as x,j as f,t as b,F as P,R as k,N as g,W as h,i as w,X as z,V as A}from"./index.ec7eb99e.js";import{Q as j}from"./QPage.b13c45b6.js";import{P as E,I as W,u as X}from"./PricingSection.01ae18e1.js";import{u as Y}from"./index.22ce7155.js";import{S as G}from"./SkeletonSinglePage.dba71dd3.js";import"./QField.ad3f8f9a.js";import"./QChip.cb7fa0e0.js";import"./QMenu.76199ca9.js";import"./selection.571043d0.js";import"./rtl.276c3f1b.js";import"./QTd.ce5eb0a5.js";import"./QTable.e99aec6c.js";import"./QMarkupTable.22b5d641.js";import"./QPopupEdit.9b1b213c.js";import"./tag.6f04df2c.js";import"./category.83d9548f.js";import"./collection.5ec0fec2.js";import"./QSkeleton.73bc54f6.js";const q={taxable:!1,track_inventory:!1,out_of_stock_track_inventory:!1,stocks:[],price:0,compare_at_price:0,cost_per_item:0},H={components:{PricingSection:E,InventorySection:W,ThumbnailSelector:T,SkeletonSinglePage:G},data(){return{loaded:!1,submited:!1,default:l.exports.cloneDeep(q),variant:l.exports.cloneDeep(q),product:!1,uploaded:[],values:[]}},methods:{...S(Y,{showProduct:"show"}),...S(X,["show","update"]),onSubmit(s){console.func("pages/admins/products/VariantPage:methods.onSubmit()",arguments),this.submited=!0,this.update(this.variant).then(({data:e,message:n})=>{this.submited=!1,this.$q.notify(n),this.variant=l.exports.cloneDeep(e),this.default=l.exports.cloneDeep(e)}).catch(e=>{this.submited=!1,this.$core.error(e,{title:this.$t("dialog.title.error")})})},onUploaded(s){console.func("pages/admins/products/VariantPage:methods.onUploaded()",arguments),this.uploaded.push(s)},onRemoved(s){console.func("pages/admins/products/VariantPage:methods.onRemoved()",arguments),this.uploaded.splice(this.uploaded.findIndex(e=>e.id===s.id),1)},onReset(s){console.func("pages/admins/products/VariantPage:methods.onReset()",arguments),Object.assign(this.variant,l.exports.cloneDeep(this.default))},onCancel(s){console.func("pages/admins/products/VariantPage:methods.onCancel()",arguments),this.$router.back()},onFilterValues(s,e,n,v){console.func("pages/admins/products/VariantPage:methods.onFilterValues()",arguments),this.values=[],Array.isArray(v.values)?e(()=>{const a=s.toLowerCase();this.values=v.values.filter(c=>c.name.toLowerCase().indexOf(a)>-1)}):n()},onChangeVariant(s){this.loaded=!1,this.show({variant_id:s.id}).then(e=>{this.variant=e,this.default=l.exports.cloneDeep(e),this.loaded=!0}).catch(e=>{this.$core.error(e,{title:this.$t("dialog.title.error")})})}},mounted(){this.showProduct(this.product_id).then(s=>{if(this.product=s,!s.has_variant)return this.$router.push({name:"Product",params:{id:this.product_id},query:{action:"edit"}}),!1;this.show({variant_id:this.id}).then(e=>{Number(this.product_id)!==e.product_id?this.$emit("error"):(this.variant=l.exports.cloneDeep(e),this.default=l.exports.cloneDeep(e),this.loaded=!0)}).catch(e=>{this.$emit("error",e)})}).catch(s=>{this.$emit("error",s)})},computed:{edit(){return["add","edit"].includes(this.action)},id(){return this.$route.params.variant_id},product_id(){return this.$route.params.product_id},action(){return this.$route.query.action},disable(){return this.default&&JSON.stringify(this.variant)===JSON.stringify(this.default)},resetable(){return this.default&&JSON.stringify(this.variant)!==JSON.stringify(this.default)}},watch:{$route(s,e){console.func("pages/admins/products/VariantPage:watch.$route()",arguments),s.name===e.name&&(this.loaded=!1,this.show({variant_id:this.id}).then(n=>{Number(this.product_id)!==n.product_id?this.$emit("error"):(this.variant=l.exports.cloneDeep(n),this.default=l.exports.cloneDeep(n),this.loaded=!0)}).catch(n=>{this.$emit("error",n)}))}}},K={class:"row q-col-gutter-md"},M={class:"col-xs-12 col-sm-8"},Z={class:"q-gutter-md"},$={class:"col-sm-8"},ee={class:"q-pt-sm q-gutter-y-md"},te={class:"col-sm-4"},se={class:"col-xs-12 col-sm-4"},ae={class:"q-gutter-md"},oe={key:0};function ie(s,e,n,v,a,c){const C=r("base-label"),D=r("thumbnail-selector"),V=r("base-section"),N=r("pricing-section"),Q=r("inventory-section"),y=r("base-thumbnail"),F=r("base-status"),I=r("base-btn"),R=r("base-form"),O=r("SkeletonSinglePage");return d(),p(j,{padding:""},{default:o(()=>[a.loaded?(d(),p(R,{key:0,onSubmit:c.onSubmit,onCancel:c.onCancel,onReset:c.onReset,resetable:c.resetable,disable:c.disable,submited:a.submited},{default:o(()=>[u("div",K,[u("div",M,[u("div",Z,[t(V,{flat:"",bordered:""},{default:o(()=>[u("div",$,[e[3]||(e[3]=u("div",{class:"text-h6"},"Options",-1)),u("div",ee,[(d(!0),_(P,null,x(a.variant.options,i=>(d(),_("div",{key:i.id},[t(C,null,{default:o(()=>[f(b(i.name),1)]),_:2},1024),t(B,{dense:"","options-dense":"",outlined:"",modelValue:i.value,"onUpdate:modelValue":m=>i.value=m,options:a.values,"map-options":"","option-label":"name","option-value":"name","emit-value":"","use-input":"","input-debounce":"0","new-value-mode":"add-unique","hide-selected":"","fill-input":"",onInputValue:m=>i.value=m,onFilter:(m,U,L)=>c.onFilterValues(m,U,L,i)},null,8,["modelValue","onUpdate:modelValue","options","onInputValue","onFilter"])]))),128))])]),u("div",te,[t(D,{label:s.$t("label.thumbnail"),"dialog-label":s.$t("label.uploadthumbnail"),hint:"You can only choose images as variant media",icon:"fad fa-image","related-files":a.product.media,modelValue:a.variant.thumbnail,"onUpdate:modelValue":e[0]||(e[0]=i=>a.variant.thumbnail=i)},null,8,["label","dialog-label","related-files","modelValue"])])]),_:1}),t(N,{flat:"",bordered:"",modelValue:a.variant,"onUpdate:modelValue":e[1]||(e[1]=i=>a.variant=i)},null,8,["modelValue"]),t(Q,{flat:"",bordered:"",modelValue:a.variant,"onUpdate:modelValue":e[2]||(e[2]=i=>a.variant=i)},null,8,["modelValue"])])]),u("div",se,[u("div",ae,[t(V,{flat:"",bordered:"","body-class":"bg-green-1","no-row":""},{default:o(()=>[a.product?(d(),_("div",oe,[t(k,{class:"q-pa-none"},{default:o(()=>[t(g,{avatar:""},{default:o(()=>[t(y,{size:80,thumbnail:a.product.thumbnail},null,8,["thumbnail"])]),_:1}),t(g,null,{default:o(()=>[t(h,{lines:"2",class:"text-h6"},{default:o(()=>[f(b(a.product.title),1)]),_:1}),t(h,{class:"q-mt-xs"},{default:o(()=>[t(F,{class:"q-ma-none",type:a.product.status},null,8,["type"])]),_:1}),t(h,{class:"q-mt-xs",caption:""},{default:o(()=>[f(b(a.product.variants_count)+" variants ",1)]),_:1}),t(h,null,{default:o(()=>[t(I,{link:"",size:"12px",padding:"0",tag:"a",label:s.$t("label.bankToProduct"),to:{name:"Product",params:{id:a.product.id},query:{action:"edit"}}},null,8,["label","to"])]),_:1})]),_:1})]),_:1})])):w("",!0)]),_:1}),t(V,{flat:"",bordered:"",title:"Variants","no-row":"",bodyClass:"q-pa-none"},{default:o(()=>[t(z),a.product?(d(),p(A,{key:0,class:"bordered"},{default:o(()=>[(d(!0),_(P,null,x(a.product.variants,(i,m)=>(d(),p(k,{to:{name:"Products Variant",params:{product_id:i.product_id,variant_id:i.id}},clickable:"",key:m},{default:o(()=>[t(g,{avatar:""},{default:o(()=>[t(y,{size:50,media:i.thumbnail},null,8,["media"])]),_:2},1024),t(g,{class:"text-bold"},{default:o(()=>[t(h,null,{default:o(()=>[f(b(i.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:1})):w("",!0)]),_:1})])])])]),_:1},8,["onSubmit","onCancel","onReset","resetable","disable","submited"])):(d(),p(O,{key:1}))]),_:1})}var ke=J(H,[["render",ie]]);export{ke as default};
