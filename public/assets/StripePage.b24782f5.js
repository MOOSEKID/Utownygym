import{_ as B,d as m,o as d,e as p,w as c,g as o,ad as D,ag as Q,h as s,aj as V,s as L,f as y,aq as N,t as k,am as T,V as q,i as C}from"./index.ec7eb99e.js";import{Q as K}from"./QPage.b13c45b6.js";import{P as Y}from"./payment.7eb652a0.js";import{_ as R}from"./logo.d17bc7ed.js";import"./QBadge.f11b4156.js";import"./QSkeleton.73bc54f6.js";var $="https://js.stripe.com/v3",W=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,A="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",F=function(){for(var t=document.querySelectorAll('script[src^="'.concat($,'"]')),r=0;r<t.length;r++){var n=t[r];if(!!W.test(n.src))return n}return null},G=function(t){var r=t&&!t.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat($).concat(r);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(n),n},M=function(t,r){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"1.54.2",startTime:r})},f=null,U=function(t){return f!==null||(f=new Promise(function(r,n){if(typeof window=="undefined"||typeof document=="undefined"){r(null);return}if(window.Stripe&&t&&console.warn(A),window.Stripe){r(window.Stripe);return}try{var i=F();i&&t?console.warn(A):i||(i=G(t)),i.addEventListener("load",function(){window.Stripe?r(window.Stripe):n(new Error("Stripe.js not available"))}),i.addEventListener("error",function(){n(new Error("Failed to load Stripe.js"))})}catch(u){n(u);return}})),f},O=function(t,r,n){if(t===null)return null;var i=t.apply(void 0,r);return M(i,n),i},I=Promise.resolve().then(function(){return U(null)}),j=!1;I.catch(function(e){j||console.warn(e)});var X=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];j=!0;var i=Date.now();return I.then(function(u){return O(u,r,i)})};let v,h,_,g;const z={layout:{type:"accordion",defaultCollapsed:!1,radios:!1,spacedAccordionItems:!0},fields:{billingDetails:{email:"never",address:{country:"never"}}}},H={theme:"flat",variables:{colorPrimaryText:"#262626"}},J={mixins:[Y],data(){return{clientSecret:null}},methods:{async load(){!this.API_KEY||(this.loading=!0,v=await X(this.API_KEY),this.token({provider:"stripe",query:this.$route.query}).then(e=>{Object.assign(this,e),h=v.elements({clientSecret:this.clientSecret,appearance:H}),_=h.create("payment",{...z,defaultValues:{billingDetails:this.billing_details}}),_.mount("#payment-element"),g=h.create("linkAuthentication"),g.mount("#link-authentication-element"),this.loading=!1,this.loaded=!0}).catch(e=>{this.$core.error(e)}))},async submit(){if(this.loading)return;this.loading=!0,v.confirmPayment({elements:h,confirmParams:{return_url:this.successUrl,payment_method_data:{billing_details:this.billing_details}},redirect:"if_required"}).then(t=>{const{error:r,paymentIntent:n}=t;r?this.$core.error(r):this.process({provider:"stripe",query:{...this.$route.query,payment_intent:n.id}})})}},async mounted(){await this.load()},computed:{API_KEY(){var e;return(e=this.paymentProvider("stripe"))==null?void 0:e.API_KEY}},watch:{API_KEY(){this.load()}},unmounted(){_.unmount(),g.unmount(),[document.querySelectorAll("[name^=__privateStripeMetricsController]"),document.querySelectorAll("[name^=__privateStripeController]")].forEach(t=>t.forEach(r=>{r.parentNode.removeChild(r)}))}},Z={style:{width:"350px"}},ee={class:"row q-col-gutter-md"},te={class:"col-xs-12 col-sm-12"},re=["src"],ne={key:1,width:"100",src:R},ie={class:"details"},se={class:"text-subtitle2"},oe={key:1,class:"text-grey-6 text-weight-regular"},ae={class:"col-xs-12 col-sm-12"},le={class:"text-center"};function de(e,t,r,n,i,u){const w=m("base-btn"),S=m("order-items"),b=m("base-section"),x=m("payment-skeleton");return d(),p(K,{class:"flex flex-center",padding:""},{default:c(()=>[o("div",Z,[D(o("div",ee,[o("div",te,[s(b,{"no-row":""},{default:c(()=>[s(V,{class:"q-pa-none"},{default:c(()=>{var a,l,E,P;return[s(L,{flat:"",round:"",dense:"",icon:"far fa-arrow-left",size:"sm",class:"q-mr-sm",onClick:e.onBack},null,8,["onClick"]),(a=e.config)!=null&&a.logo?(d(),y("img",{key:0,width:"100",src:(l=e.config)==null?void 0:l.logo},null,8,re)):(d(),y("img",ne)),s(N),o("div",ie,[o("div",se,k((E=e.order)==null?void 0:E.amount),1),e.$q.screen.xs?(d(),p(w,{key:0,onClick:t[0]||(t[0]=ce=>e.$refs.details.toggle()),color:"grey",label:"Details",link:""})):(d(),y("div",oe,k((P=e.order)==null?void 0:P.label),1))])]}),_:1}),s(T,{square:"",ref:"details",position:"bottom"},{default:c(()=>[s(q,{class:"bg-white q-pa-md"},{default:c(()=>{var a,l;return[s(S,{"line-items":(a=e.order)==null?void 0:a.line_items,currency:(l=e.order)==null?void 0:l.currency},null,8,["line-items","currency"])]}),_:1})]),_:1},512),e.$q.screen.gt.xs?(d(),p(q,{key:0,class:"q-mt-md"},{default:c(()=>{var a,l;return[s(S,{"line-items":(a=e.order)==null?void 0:a.line_items,currency:(l=e.order)==null?void 0:l.currency},null,8,["line-items","currency"])]}),_:1})):C("",!0)]),_:1})]),o("div",ae,[s(b,{"no-row":"",class:"stripe-payment"},{default:c(()=>[t[1]||(t[1]=o("div",{id:"link-authentication-element"},null,-1)),t[2]||(t[2]=o("div",{id:"payment-element"},null,-1)),o("div",le,[s(w,{onClick:u.submit,id:"submit",label:"Pay Now",disable:e.loading,style:{"min-width":"150px"},padding:"10px",class:"q-mt-md"},null,8,["onClick","disable"])])]),_:1})])],512),[[Q,e.loaded]]),e.loaded?C("",!0):(d(),p(x,{key:0}))])]),_:1})}var ve=B(J,[["render",de]]);export{ve as default};
