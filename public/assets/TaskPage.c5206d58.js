import{_ as N,m,T as D,d as n,o as r,e as u,w as i,g as o,h as a,S as Q,O as R,f as d,j as p,t as c,F as b,n as B,p as v,i as k,ar as z}from"./index.ec7eb99e.js";import{Q as H}from"./QTimeline.c279b714.js";import{Q as L}from"./QPage.b13c45b6.js";import{S as M}from"./SkeletonSinglePage.dba71dd3.js";import{R as $}from"./ReplyCard.2946e011.js";import{u as F}from"./task.2de92383.js";import{u as x}from"./staff.565aabca.js";import{P as E}from"./mixins.af528ab3.js";import"./QSkeleton.73bc54f6.js";import"./FileSelectorDialog.014f4c1d.js";import"./enquiry.b5f57f80.js";import"./StateSelect.d3ce42fc.js";import"./index.becf6c0c.js";import"./CitySelect.367b922a.js";import"./BaseSectionSkeleton.971da8dd.js";import"./page.e7247b54.js";import"./QExpansionItem.38c12bfd.js";import"./QSlideTransition.d1b840b3.js";import"./QMenu.76199ca9.js";import"./selection.571043d0.js";const y={media:[],status:"Pending",message:""},I={mixins:[E],components:{SkeletonSinglePage:M,ReplyCard:$},data(){return{defaultData:m.exports.cloneDeep(y),formData:m.exports.cloneDeep(y)}},methods:{...D(F,["store","show","update","delete","reply","changeArchived"]),...D(x,{getStaff:"options",getUser:"show"}),onCreateNote(e){console.func("pages/core/tasks/TaskPage:methods.onCreateNote()",arguments),e?(this.formData.replies.splice(0,0,m.exports.cloneDeep(e)),this.defaultData.replies.splice(0,0,m.exports.cloneDeep(e))):this.show(this.id).then(l=>{this.formData=l,this.defaultData=m.exports.cloneDeep(l)})},onDelete(e){console.func("pages/core/tasks/TaskPage:methods.onDelete()",arguments),this.$core.confirm(this.$t("dialog.info.warning")).then(()=>{this.delete(this.id).then(()=>{this.$router.push({name:"Tasks"})}).catch(l=>{this.$core.error(l,{title:this.$t("dialog.title.error")})})})},onUpdateArchived(){console.func("pages/core/tasks/TaskPage:methods.onUpdateArchived()",arguments),this.changeArchived(this.formData).then(()=>{this.defaultData=m.exports.cloneDeep(this.formData)})}},async mounted(){this.creating?this.loaded=!0:this.show(this.id).then(e=>{this.$app.setTitle(e.subject),this.formData=e,this.defaultData=m.exports.cloneDeep(e),this.loaded=!0}).catch(e=>{this.$emit("error",e)})},computed:{title(){return this.creating?this.$t("generalInformation"):null}}},O={class:"q-gutter-md"},G={class:"col-xs-12"},J={class:"col-xs-12"},K={class:"col-xs-12"},W={class:"col-xs-12"},X={class:"col-xs-12 col-sm-12"},Y={class:"col"},Z={class:"flex"},ee={class:"subject text-h6"},te={class:"created-at"},se={class:"col-auto"},oe={class:"col-xs-12 col-sm-12"},ae=["innerHTML"],le={key:2,class:"col-xs-12"},ne={class:"files"},re={class:"row q-col-gutter-sm"};function ie(e,l,me,de,t,f){const h=n("base-label"),V=n("base-input"),C=n("base-select"),S=n("base-editor"),T=n("base-dropzone"),w=n("base-status"),P=n("base-avatars"),U=n("base-media-card"),q=n("base-btn"),_=n("base-section"),g=n("reply-card"),j=n("base-form"),A=n("skeleton-single-page");return r(),u(L,{padding:""},{default:i(()=>[e.loaded?(r(),u(j,{key:0,onSubmit:e.onSubmit,onCancel:e.onCancel,onReset:e.onReset,resetable:e.resetable,disable:e.disable,submited:e.submited,"no-action":!e.creating,"save-label":e.$t("send")},{default:i(()=>[o("div",O,[a(_,{flat:"",bordered:"",title:f.title,"head-class":"q-pb-sm"},Q({default:i(()=>[e.creating?(r(),d(b,{key:0},[o("div",G,[a(h,{required:""},{default:i(()=>[p(c(e.$t("subject")),1)]),_:1}),a(V,{modelValue:t.formData.subject,"onUpdate:modelValue":l[0]||(l[0]=s=>t.formData.subject=s),name:"subject"},null,8,["modelValue"])]),o("div",J,[a(h,{required:""},{default:i(()=>[p(c(e.$t("label.staff")),1)]),_:1}),a(C,{placeholder:e.$t("placeholder.selectStaff"),dense:"",outlined:"",modelValue:t.formData.users,"onUpdate:modelValue":l[1]||(l[1]=s=>t.formData.users=s),name:"users","filter-method":e.getStaff,"map-options":"","use-filter":"",multiple:"","use-chips":"","cache-key":"admins","option-label":s=>`${s.name} (${s.email})`},null,8,["placeholder","modelValue","filter-method","option-label"])]),o("div",K,[a(h,{required:""},{default:i(()=>[p(c(e.$t("label.message")),1)]),_:1}),a(S,{modelValue:t.formData.message,"onUpdate:modelValue":l[2]||(l[2]=s=>t.formData.message=s),name:"message"},null,8,["modelValue"])]),o("div",W,[a(h,null,{default:i(()=>[p(c(e.$t("attachment")),1)]),_:1}),a(T,{modelValue:t.formData.media,"onUpdate:modelValue":l[3]||(l[3]=s=>t.formData.media=s),name:"media"},null,8,["modelValue"])])],64)):(r(),d(b,{key:1},[o("div",X,[o("div",{class:B({"meta-section":!0,row:e.$q.screen.gt.xs})},[o("div",Y,[o("div",Z,[o("div",ee,c(t.formData.subject),1)]),o("div",te,[p(c(e.$core.formatDateAsHuman(t.formData.created_at))+" ",1),a(w,{type:t.formData.status},null,8,["type"])])]),o("div",se,[a(P,{items:t.formData.users},null,8,["items"])])],2)]),o("div",oe,[o("span",{innerHTML:t.formData.message},null,8,ae)])],64)),!e.creating&&t.formData.media.length?(r(),d("div",le,[o("div",ne,[o("div",re,[(r(!0),d(b,null,v(t.formData.media,s=>(r(),d("div",{key:s.id,class:"col-sm-2 col-xs-12"},[a(U,{media:s},null,8,["media"])]))),128))])])])):k("",!0)]),_:2},[e.creating?void 0:{name:"bottom",fn:i(()=>[a(R,{"model-value":t.formData.is_archived,"onUpdate:modelValue":f.onUpdateArchived,label:e.$t("archived"),color:"warning",dense:""},null,8,["model-value","onUpdate:modelValue","label"]),a(q,{class:"q-ml-md",color:"negative",icon:"fas fa-trash-can",onClick:f.onDelete,label:e.$t("delete"),link:""},null,8,["onClick","label"])]),key:"0"}]),1032,["title"]),e.creating?k("",!0):(r(),u(_,{key:0,flat:"",bordered:"",title:e.$t("activities"),description:e.$t("tasks.activityDesc"),"no-row":"","body-class":"q-px-lg"},{default:i(()=>[a(H,{class:"comments",color:"secondary"},{default:i(()=>[a(g,{creating:"","is-admin":"","reply-method":e.reply,"module-id":t.formData.id,class:"comment",onCreate:f.onCreateNote},null,8,["reply-method","module-id","onCreate"]),(r(!0),d(b,null,v(t.formData.replies,s=>(r(),u(g,z({class:"comment",key:s.id,ref_for:!0},s,{"module-id":t.formData.id,user:s.user}),null,16,["module-id","user"]))),128))]),_:1})]),_:1},8,["title","description"]))])]),_:1},8,["onSubmit","onCancel","onReset","resetable","disable","submited","no-action","save-label"])):(r(),u(A,{key:1}))]),_:1})}var je=N(I,[["render",ie]]);export{je as default};
