import{u as R,bt as P,c as r,A as d,T as v,U as S,_ as k,d as c,o as h,e as y,w as i,j as f,t as u,h as b,s as A,ae as _,i as B}from"./index.ec7eb99e.js";import{u as N}from"./member.8ccf3331.js";const q=R();var $;const m=($=q.config)==null?void 0:$.currency,D=async(e,t)=>{await r.viewPdf(t,`reports-${e}`)},w=e=>new Promise((t,a)=>{d.download("users/reports/pdf",e,{method:"post"}).then(l=>{const n=new Blob([l],{type:"application/pdf"});e.download?r.downloadBlob(`reports-${e.type}`,n):D(e.type,l),t(l)}).catch(l=>{r.error(l,{title:store.$t("dialog.title.error")}),a(l)})}),M=P("member-report",{getters:{module:e=>({name:e.$t("label.memberReports"),singular:e.$t("singular.memberReport"),plural:e.$t("plural.memberReports")}),reportColumns:e=>[{name:"total",field:"total",label:e.$t("label.total"),sortable:!1,align:"center",stats:!0,load:!0},{name:"rolling_total",field:"rolling_total",label:e.$t("label.rolling")+"("+m+")",format:t=>t!==void 0?r.money(t):null,sortable:!1,align:"center",stats:!1},{name:"rolling",field:"rolling",label:e.$t("label.rolling"),sortable:!1,align:"center",stats:!0,load:!0},{name:"end_date_total",field:"end_date_total",label:e.$t("label.endDate")+"("+m+")",format:t=>t!==void 0?r.money(t):null,sortable:!1,align:"center",stats:!1},{name:"end_date",field:"end_date",label:e.$t("label.endDate"),sortable:!1,align:"center",stats:!0,load:!0},{name:"free",field:"free",label:e.$t("label.free"),sortable:!1,align:"center",stats:!0,load:!0},{name:"cancelled_total",field:"cancelled_total",label:e.$t("label.cancelled")+"("+m+")",format:t=>t!==void 0?r.money(t):null,sortable:!1,align:"center",stats:!1},{name:"cancelled",field:"cancelled",label:e.$t("label.cancelled"),sortable:!1,align:"center",stats:!1,load:!0},{name:"total_paid",align:"left",label:e.$t("totalSpend")+"("+m+")",field:"total_paid",format:t=>t!==void 0?r.money(t):null,style:"width: 40px",sortable:!1}],dailyReportColumns:e=>[{name:"id",field:"id",label:e.$t("label.day"),sortable:!1,style:"width: 15px",align:"left",stats:!1},...e.reportColumns],monthlyReportColumns:e=>[{name:"id",field:"id",label:e.$t("label.month"),sortable:!1,style:"width: 15px",align:"left",stats:!1},...e.reportColumns],yearlyReportColumns:e=>[{name:"id",field:"label",label:e.$t("label.year"),sortable:!1,style:"width: 15px",align:"left",stats:!1},...e.reportColumns],toolbar:e=>[{title:e.$t("label.date"),action:"request",component:"base-date-input",dense:!0,outlined:!0,key:"date",placeholder:e.$t("placeholder.select"),style:"width: 150px",prefix:e.$t("prefix.date"),deleted:"all",width:"6"},{tooltip:e.$t("tooltip.exportAsCsv"),icon:"fas fa-file-csv",action:"export",color:"primary",deleted:"all",type:"csv",name:"daily_reports",padding:"14px"},{tooltip:e.$t("tooltip.exportAsPdf"),icon:"fas fa-file-pdf",action:({columns:t,rows:a})=>w({type:"daily",download:!0,columns:t,rows:a}),color:"primary",deleted:"all",type:"pdf",padding:"14px"},{tooltip:e.$t("tooltip.print"),icon:"fas fa-print",action:({columns:t,rows:a})=>w({type:"daily",columns:t,rows:a}),color:"primary",deleted:"all",padding:"14px"}]},actions:{get(e){return new Promise((t,a)=>{d.get("users/reports",e).then(l=>{t(l)}).catch(l=>{a(l)})})},reportsDaily(e){return new Promise((t,a)=>{d.get("users/reports/daily",e).then(l=>{t(l)}).catch(l=>{a(l)})})},reportsMonthly(e){return new Promise((t,a)=>{d.get("users/reports/monthly",e).then(l=>{t(l)}).catch(l=>{a(l)})})},reportsYearly(e){return new Promise((t,a)=>{d.get("users/reports/yearly",e).then(l=>{t(l)}).catch(l=>{a(l)})})}}}),T={props:{year:[String,Number],month:[String,Number],day:[String,Number],type:String,noResponsive:Boolean},data(){return{loading:!1,loaded:!1,pagination:{sortBy:"created_at",descending:!1,page:1,filter:"",deleted:!1,rowsPerPage:15,rowsNumber:15,loaded:!1,year:this.year,month:this.month,day:this.day,type:this.type},columns:[{name:"id",align:"left",label:this.$t("subscriptionId"),field:"id",style:"width: 40px",sortable:!0},{name:"user_name",align:"left",label:this.$t("label.name"),field:"user_name",style:"width: 40px",sortable:!0},{name:"plan_label",align:"left",label:this.$t("label.plan"),field:"plan_label",style:"width: 250px; white-space: normal",sortable:!0},{name:"created_at",align:"left",label:this.$t("label.startsAt"),style:"width: 40px",field:"created_at",format:this.$core.formatAsDateOnly,sortable:!0},{name:"ends_at",align:"left",label:this.$t("label.endsAt"),style:"width: 40px",field:"ends_at",format:this.$core.formatAsDateOnly,sortable:!0},{name:"plan_price",align:"left",label:this.$t("label.renewalFee"),field:"plan_price",format:e=>this.$core.money(e),style:"width: 40px",sortable:!0},{name:"total_paid",align:"left",label:this.$t("totalSpend"),field:"total_paid",format:e=>this.$core.money(e),style:"width: 40px",sortable:!0},{name:"status",align:"left",label:this.$t("label.status"),field:"status",style:"width: 40px",sortable:!0}],rows:[]}},methods:{...v(M,["get"]),onRequest(e){console.func("components/MembersTable:methods.onRequest()",arguments);const{page:t,rowsPerPage:a,sortBy:l,descending:n}=e.pagination;this.loading=!0,this.get({...e.pagination,direction:n?"desc":"asc"}).then(({meta:s,data:p})=>{this.rows=p,this.pagination.rowsNumber=s.total,this.pagination.page=t,this.pagination.rowsPerPage=a,this.pagination.sortBy=l,this.pagination.descending=n,this.pagination.loaded=!0,this.pagination.from=s.from,this.pagination.to=s.to,this.loading=!1}).catch(s=>{this.$core.error(s,{title:this.$t("dialog.title.error")})})},onExport(){console.func("components/MembersTable:methods.onExport()",arguments),this.$refs.members.onToolbarClicked({action:"export",type:"csv",method:this.get})}},computed:{...S(N,["module"])}};function E(e,t,a,l,n,s){const p=c("base-btn"),x=c("base-status"),C=c("base-table");return h(),y(C,{module:e.module,columns:n.columns,rows:n.rows,loading:n.loading,pagination:n.pagination,onRequest:s.onRequest,"no-data-label":e.$t("members.noData"),"no-permissions":"","no-responsive":a.noResponsive,"hide-top":"",ref:"members"},{"header-cell-id":i(o=>[f(u(o.col.label)+" ",1),b(A,{flat:"",round:"",color:"primary",icon:"fas fa-file-csv",onClick:s.onExport,dense:"",size:"sm"},null,8,["onClick"])]),"body-cell-user_name":i(o=>[b(p,{onClick:t[0]||(t[0]=_(()=>{},["stop"])),link:"",size:"12px",tag:"a",to:{name:"Member",params:{id:o.row.user_id},query:{action:"edit"}}},{default:i(()=>[f(u(o.value),1)]),_:2},1032,["to"])]),"body-cell-plan_label":i(o=>{var g;return[b(p,{onClick:t[1]||(t[1]=_(()=>{},["stop"])),link:"",size:"12px",tag:"a",to:{name:"Plan",params:{id:(g=o.row)==null?void 0:g.plan_id},query:{action:"edit"}}},{default:i(()=>[f(u(o.value),1)]),_:2},1032,["to"])]}),"body-cell-status":i(o=>[o.value?(h(),y(x,{key:0,type:o.value},null,8,["type"])):B("",!0)]),_:1},8,["module","columns","rows","loading","pagination","onRequest","no-data-label","no-responsive"])}var O=k(T,[["render",E]]);export{O as R,M as u};
