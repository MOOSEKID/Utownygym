import{m as f,T as U,_ as k,d as x,o as i,e as _,w as n,h as s,V as A,f as u,F as b,p as S,aU as M,al as q,g as t,ad as $,s as g,af as P,O,X as C,j as h,t as c,aq as Q,R as D,N as v,W as V,ah as H,i as y,S as T,q as N,ar as L}from"./index.ec7eb99e.js";import{u as I}from"./location.60ab6585.js";import{Q as F}from"./QMenu.76199ca9.js";import{Q as E}from"./QMarkupTable.22b5d641.js";import{A as z}from"./AddDiscount.6731a85e.js";import{Q as R}from"./QPopupEdit.9b1b213c.js";import{Q as j}from"./QSelect.ad394656.js";import{u as J}from"./payment-method.c410ea94.js";import{u as W}from"./member.8ccf3331.js";import{A as X}from"./AddressFields.afbf970a.js";const G={props:{modelValue:{required:!0,type:Object,default:()=>({})}},data(){return{location:f.exports.cloneDeep(this.modelValue||{}),default:f.exports.cloneDeep(this.modelValue||{}),locations:[]}},emits:["ok","hide"],methods:{...U(I,["get"]),async show(){console.func("components/order/ChangeLocation:methods.show()",arguments),await this.get().then(({data:l})=>{this.locations=l,this.$refs.dialog.show()}).catch(l=>{this.$core.error(l,{title:"Error"})})},hide(){console.func("components/order/ChangeLocation:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/order/ChangeLocation:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/order/ChangeLocation:methods.onDone()",arguments),this.$emit("ok",this.location),this.hide()}},computed:{disable(){return JSON.stringify(this.location)===JSON.stringify(this.default)}}},K={class:"q-gutter-sm"};function Y(l,e,p,w,o,d){const r=x("base-dialog");return i(),_(r,{title:"Change location","body-class":"scroll",ref:"dialog",persistent:"",onHide:d.onDialogHide,"use-separator":""},{body:n(()=>[s(A,{class:"bordered q-gutter-sm"},{default:n(()=>[(i(!0),u(b,null,S(o.locations,a=>(i(),u("div",{key:a.id},[s(M,{size:"sm","onUpdate:modelValue":[m=>o.location=a,e[0]||(e[0]=m=>o.location.id=m)],dense:"",modelValue:o.location.id,val:a.id,label:a.name},null,8,["onUpdate:modelValue","modelValue","val","label"])]))),128))]),_:1})]),footer:n(()=>[s(q,{class:"text-right"},{default:n(()=>[t("div",K,[$(s(g,{"no-caps":"",outline:"",label:"Cancel",color:"grey"},null,512),[[P]]),s(g,{disable:d.disable,"no-caps":"",label:"Done",color:"primary",onClick:d.onDone},null,8,["disable","onClick"])])]),_:1})]),_:1},8,["onHide"])}var po=k(G,[["render",Y]]);const Z={props:{modelValue:[Boolean]},emits:["update:model-value"],data(){return{collect_tax:this.modelValue}}},ee={class:"q-pa-md"},oe={class:"q-pa-md text-right"},te={class:"q-gutter-sm"};function se(l,e,p,w,o,d){return i(),_(R,{"label-set":"Save",class:"q-pa-none",style:{width:"300px","max-width":"95vw"},"content-class":"base-popup-edit",modelValue:o.collect_tax,"onUpdate:modelValue":[e[0]||(e[0]=r=>o.collect_tax=r),e[1]||(e[1]=r=>l.$emit("update:model-value",r))]},{default:n(r=>[t("div",ee,[e[2]||(e[2]=t("div",{class:"q-mb-sm"},"Taxes are automatically calculated.",-1)),s(O,{dense:"",modelValue:r.value,"onUpdate:modelValue":a=>r.value=a,label:"Collect taxes"},null,8,["modelValue","onUpdate:modelValue"])]),s(C),t("div",oe,[t("div",te,[s(g,{size:"12px",onClick:a=>r.cancel(),"no-caps":"",color:"grey",outline:"",label:"Cancel"},null,8,["onClick"]),s(g,{size:"12px",onClick:a=>r.set(),"no-caps":"",color:"positive",label:"Apply"},null,8,["onClick"])])])]),_:1},8,["modelValue"])}var le=k(Z,[["render",se]]);const ne={emits:["ok","hide"],props:{modelValue:{required:!0,type:Object}},data(){return{order:f.exports.cloneDeep(this.modelValue),options:[],payment_method:null,payment_method_error:!1}},methods:{...U(J,["get"]),async show(){console.func("components/order/ManualPayment:methods.show()",arguments),await this.get({manual:!0}).then(l=>{var e;this.options=l,this.payment_method=(e=l[0])==null?void 0:e.id,this.$refs.dialog.show()}).catch(l=>{this.$core.error(l,{title:"Error"})})},hide(){console.func("components/order/ManualPayment:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/order/ManualPayment:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){if(console.func("components/order/ManualPayment:methods.onDone()",arguments),!this.payment_method)return this.payment_method_error=!0,!1;this.$emit("ok",this.payment_method),this.hide()}},computed:{submit_button_label(){return this.order.id?"Mark as paid":"Create order"}}},ie={class:"row q-col-gutter-md"},ae={class:"col-sm-12 col-xs-12"},de={class:""},re={class:"col-sm-12 col-xs-12"},ue={class:"q-gutter-sm"};function ce(l,e,p,w,o,d){const r=x("base-dialog");return i(),_(r,{"content-style":"width: 600px; max-width: 95vw",title:"Mark as paid","body-class":"scroll",ref:"dialog",persistent:"",onHide:d.onDialogHide,"use-separator":""},{body:n(()=>[t("div",ie,[t("div",ae,[t("div",de,[e[2]||(e[2]=h(" Mark this order as paid if you received ")),t("strong",null,c(l.$core.money(o.order.due_amount)),1),e[3]||(e[3]=h(" outside. This payment won't be captured and you won't be able to refund it using app. "))])]),t("div",re,[e[5]||(e[5]=t("div",{class:"text-label"},"Received payment method",-1)),s(j,{style:{width:"250px"},dense:"",modelValue:o.payment_method,"onUpdate:modelValue":[e[0]||(e[0]=a=>o.payment_method=a),e[1]||(e[1]=a=>o.payment_method_error=!1)],options:o.options,outlined:"","map-options":"","option-label":"name","option-value":"id","emit-value":"",error:o.payment_method_error},{error:n(()=>e[4]||(e[4]=[t("div",null," Payment method is required. Please select a received payment method. ",-1)])),_:1},8,["modelValue","options","error"])])])]),footer:n(()=>[s(q,{class:"row flex"},{default:n(()=>[s(Q),t("div",ue,[$(s(g,{"no-caps":"",outline:"",label:"Cancel",color:"grey"},null,512),[[P]]),s(g,{"no-caps":"",label:d.submit_button_label,color:"primary",onClick:d.onDone},null,8,["label","onClick"])])]),_:1})]),_:1},8,["onHide"])}var me=k(ne,[["render",ce]]);const pe={emits:["ok","hide"],props:{modelValue:{required:!0,type:Object}},data(){return{order:f.exports.cloneDeep(this.modelValue),invoice:{to:this.modelValue.customer.email,from:{label:'"Shoparket" <hello@shoparket.com>',email:"hello@shoparket.com"},subject:"Invoice {{label}}",message:null,order:this.modelValue.id},options:[],review:!1}},methods:{async show(){console.func("components/order/SendInvoice:methods.show()",arguments),this.options=[{label:'"Shoparket" <hello@shoparket.com>',email:"hello@shoparket.com"}],this.$refs.dialog.show()},hide(){console.func("components/order/SendInvoice:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/order/SendInvoice:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/order/SendInvoice:methods.onDone()",arguments),this.review?(this.$emit("ok",this.payment_method),this.hide()):this.review=!0}},computed:{submit_button_label(){return this.review?"Send invoice":"Review invoice"}}},he={key:0,class:"row q-col-gutter-md"},fe={class:"col-sm-12 col-xs-12"},_e={class:"col-sm-12 col-xs-12"},ge={key:1,class:"row q-col-gutter-md"},ve={class:"col-sm-6 col-xs-12"},be={class:"col-sm-6 col-xs-12"},xe={class:"col-sm-12 col-xs-12"},ye={class:"col-sm-12 col-xs-12"},ke={class:"q-gutter-sm"};function we(l,e,p,w,o,d){const r=x("base-dialog");return i(),_(r,{"content-style":"width: 700px; max-width: 95vw",title:"Send invoice","body-class":"scroll",class:"send-invoice",ref:"dialog",persistent:"",onHide:d.onDialogHide,"use-separator":""},{body:n(()=>[o.review?(i(),u("div",he,[t("div",fe,[s(A,{class:"bordered",dense:""},{default:n(()=>[s(D,null,{default:n(()=>[s(v,{avatar:""},{default:n(()=>[s(V,{class:"text-bold"},{default:n(()=>e[5]||(e[5]=[h("To")])),_:1})]),_:1}),s(v,null,{default:n(()=>[s(V,{caption:""},{default:n(()=>[h(c(o.invoice.to),1)]),_:1})]),_:1})]),_:1}),s(D,null,{default:n(()=>[s(v,{avatar:""},{default:n(()=>[s(V,{class:"text-bold"},{default:n(()=>e[6]||(e[6]=[h("From")])),_:1})]),_:1}),s(v,null,{default:n(()=>[s(V,{caption:""},{default:n(()=>[h(c(o.invoice.from.label),1)]),_:1})]),_:1})]),_:1}),s(D,null,{default:n(()=>[s(v,{avatar:""},{default:n(()=>[s(V,{class:"text-bold"},{default:n(()=>e[7]||(e[7]=[h("Subject")])),_:1})]),_:1}),s(v,null,{default:n(()=>[s(V,{caption:""},{default:n(()=>[h(c(o.invoice.subject),1)]),_:1})]),_:1})]),_:1})]),_:1})]),t("div",_e,c(o.invoice.message),1)])):(i(),u("div",ge,[t("div",ve,[e[8]||(e[8]=t("div",{class:"text-label"},"To",-1)),s(H,{dense:"",outlined:"",modelValue:o.invoice.to,"onUpdate:modelValue":e[0]||(e[0]=a=>o.invoice.to=a),type:"email"},null,8,["modelValue"])]),t("div",be,[e[9]||(e[9]=t("div",{class:"text-label"},"From",-1)),s(j,{dense:"",modelValue:o.invoice.from,"onUpdate:modelValue":e[1]||(e[1]=a=>o.invoice.from=a),options:o.options,outlined:"","map-options":"","option-label":"label","option-value":"email"},null,8,["modelValue","options"])]),t("div",xe,[e[10]||(e[10]=t("div",{class:"text-label"},"Subject",-1)),s(H,{dense:"",outlined:"",modelValue:o.invoice.subject,"onUpdate:modelValue":e[2]||(e[2]=a=>o.invoice.subject=a)},null,8,["modelValue"])]),t("div",ye,[e[12]||(e[12]=t("div",{class:"text-label"},"Custom message (optional)",-1)),s(H,{"bottom-slots":"",outlined:"",modelValue:o.invoice.message,"onUpdate:modelValue":e[3]||(e[3]=a=>o.invoice.message=a),type:"textarea"},{hint:n(()=>e[11]||(e[11]=[t("div",null,[h(" This template can be edited in "),t("a",{href:"javascript:void()"},"notifications")],-1)])),_:1},8,["modelValue"])])]))]),footer:n(()=>[s(q,{class:"row flex"},{default:n(()=>[o.review?(i(),_(g,{key:0,onClick:e[4]||(e[4]=a=>o.review=!o.review),"no-caps":"",outline:"",label:"Back",color:"grey"})):y("",!0),s(Q),t("div",ke,[$(s(g,{"no-caps":"",outline:"",label:"Cancel",color:"grey"},null,512),[[P]]),s(g,{"no-caps":"",label:d.submit_button_label,color:"primary",onClick:d.onDone},null,8,["label","onClick"])])]),_:1})]),_:1},8,["onHide"])}var Ve=k(pe,[["render",we]]);const De={components:{CollectTax:le},props:{modelValue:{type:[Object],required:!0},view:Boolean,hasDue:Boolean,hasPayment:Boolean},emits:["update:model-value","marked-paid"],data(){return{order:f.exports.cloneDeep(this.modelValue)}},methods:{addDiscount(l){console.func("components/order/BillingDetails:methods.addDiscount()",arguments),this.$q.dialog({component:z,componentProps:{modelValue:f.exports.cloneDeep(l.discount),update:Boolean(l.discount)}}).onOk(e=>{console.func("components/order/BillingDetails:methods.addDiscount.onOk()",e),e||(l.discount_removed=!0),l.discount=e,this.$emit("update:model-value",this.order)})},addShipping(l){console.func("components/order/BillingDetails:methods.addShipping()",arguments),this.$q.dialog({component:AddShipping,componentProps:{modelValue:f.exports.cloneDeep(l.shipping_line),update:Boolean(l.shipping_line)}}).onOk(e=>{console.func("components/order/BillingDetails:methods.addShipping.onOk()",e),e||(l.shipping_line_removed=!0),l.shipping_line=e,this.$emit("update:model-value",this.order)})},onChangeTax(l){this.order.collect_tax=l,this.$emit("update:model-value",this.order)},onMarkAsPaid(){console.func("components/order/BillingDetails:methods.onMarkAsPaid()",arguments),this.$q.dialog({component:me,componentProps:{modelValue:f.exports.cloneDeep(this.order)}}).onOk(l=>{this.$emit("marked-paid",l)})},onSendInvoice(){console.func("components/order/BillingDetails:methods.onSendInvoice()",arguments),this.$q.dialog({component:Ve,componentProps:{modelValue:f.exports.cloneDeep(this.order)}}).onOk(l=>{this.$emit("send-invoice",l)})}},watch:{modelValue:{deep:!0,handler(l){this.order=f.exports.cloneDeep(l)}}},computed:{canCollectPayment(){return this.hasDue&&!this.order.is_cancelled},hasTaxes(){return this.order.collect_tax&&this.order.tax_lines.length}}},Ce={class:"billing-details"},Se={class:"text-left"},qe={key:0},$e={class:"text-right"},Pe={class:"text-left"},Be={key:1},He={class:"text-left"},Ue={class:"text-right"},Ae={class:"text-right"},Qe={class:"text-left"},je={key:1},Me={class:"text-left"},Oe={class:"text-right"},Te={class:"text-right"},Ne={class:"text-right text-weight-medium"},Le={key:0},Ie={colspan:"100%"},Fe={key:1,class:"text-primary"},Ee={class:"text-right text-weight-medium"},ze={key:2,class:"text-orange-9"},Re={class:"text-right text-weight-medium"},Je={class:"row flex"},We={class:"q-gutter-md"};function Xe(l,e,p,w,o,d){const r=x("base-btn"),a=x("collect-tax");return i(),u("div",Ce,[s(E,{class:"no-hover","wrap-cells":"",flat:"",dense:"",separator:"none"},{default:n(()=>[t("tbody",null,[t("tr",null,[e[2]||(e[2]=t("td",{class:"text-left"},"Subtotal",-1)),t("td",Se,[p.view?(i(),u("div",qe,c(o.order.total_products),1)):y("",!0)]),t("td",$e,c(l.$core.money(o.order.sub_total)),1)]),t("tr",null,[t("td",Pe,[p.view?(i(),u("div",Be,"Discount")):(i(),_(r,{key:0,onClick:e[0]||(e[0]=m=>d.addDiscount(o.order)),label:o.order.discount?"Edit discount":"Add discount",link:""},null,8,["label"]))]),o.order.discount?(i(),u(b,{key:0},[t("td",He,c(o.order.discount.description||"Custom discount"),1),t("td",Ue,"-"+c(l.$core.money(o.order.discount_total)),1)],64)):(i(),u(b,{key:1},[e[3]||(e[3]=t("td",{class:"text-left"},"\u2014",-1)),t("td",Ae,c(l.$core.money(0)),1)],64))]),t("tr",null,[t("td",Qe,[p.view?(i(),u("div",je,"Tax")):(i(),_(r,{key:0,label:"Tax",link:""},{default:n(()=>[s(a,{"transition-show":"jump-up","transition-hide":"jump-down",modelValue:o.order.collect_tax,"onUpdate:modelValue":[e[1]||(e[1]=m=>o.order.collect_tax=m),d.onChangeTax]},null,8,["modelValue","onUpdate:modelValue"])]),_:1}))]),d.hasTaxes?(i(),u(b,{key:0},[t("td",Me,[o.order.tax_lines.length>1?(i(),_(r,{key:0,padding:"0",label:"All tax rates",link:""},{default:n(()=>[s(F,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:n(()=>[s(A,{class:"q-pa-sm",style:{"min-width":"200px"}},{default:n(()=>[(i(!0),u(b,null,S(o.order.tax_lines,(m,B)=>(i(),_(D,{dense:"",class:"q-px-sm q-pa-none",key:B},{default:n(()=>[s(v,{avatar:""},{default:n(()=>[h(c(`${m.label} ${m.rate}%`),1)]),_:2},1024),s(v,{class:"text-right q-pa-none"},{default:n(()=>[h(c(l.$core.money(m.amount)),1)]),_:2},1024)]),_:2},1024))),128)),s(C),s(D,{dense:"",class:"q-px-sm q-pa-none"},{default:n(()=>[s(v,{class:"text-weight-bold",avatar:""},{default:n(()=>e[4]||(e[4]=[h(" Total tax ")])),_:1}),s(v,{class:"text-right text-weight-bold q-pa-none"},{default:n(()=>[h(c(l.$core.money(o.order.tax_total)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(i(!0),u(b,{key:1},S(o.order.tax_lines,(m,B)=>(i(),u("div",{key:B},c(`${m.label} ${m.rate}%`),1))),128))]),t("td",Oe,c(l.$core.money(o.order.tax_total)),1)],64)):(i(),u(b,{key:1},[e[5]||(e[5]=t("td",{class:"text-left"},"Not collected",-1)),t("td",Te,c(l.$core.money(o.order.tax_total)),1)],64))]),t("tr",null,[e[6]||(e[6]=t("td",{class:"text-left text-weight-medium"},"Total",-1)),e[7]||(e[7]=t("td",{class:"text-left"},null,-1)),t("td",Ne,c(l.$core.money(o.order.grand_total)),1)]),p.hasPayment?(i(),u(b,{key:0},[o.order.paid_total||p.hasDue?(i(),u("tr",Le,[t("td",Ie,[s(C)])])):y("",!0),o.order.paid_total?(i(),u("tr",Fe,[e[8]||(e[8]=t("td",{class:"text-left text-weight-medium"},"Paid by customer",-1)),e[9]||(e[9]=t("td",{class:"text-left"},null,-1)),t("td",Ee,c(l.$core.money(o.order.paid_total)),1)])):y("",!0),p.hasDue?(i(),u("tr",ze,[e[10]||(e[10]=t("td",{class:"text-left text-weight-medium"}," Balance (customer owes you) ",-1)),e[11]||(e[11]=t("td",{class:"text-left"},null,-1)),t("td",Re,c(l.$core.money(o.order.due_amount)),1)])):y("",!0)],64)):y("",!0)])]),_:1}),d.canCollectPayment?(i(),u(b,{key:0},[s(C,{class:"q-my-md"}),t("div",Je,[s(Q),t("div",We,[s(r,{onClick:d.onMarkAsPaid,icon:"fas fa-credit-card",size:"md",label:"Mark as paid"},null,8,["onClick"])])])],64)):y("",!0)])}var ho=k(De,[["render",Xe]]);const Ge=["prepend","selected","before-options","after-options","no-option"],Ke={props:{modelValue:{},hideNoOption:Boolean,onNewValue:Function,optionLabel:[Function,String]},emits:["update:model-value"],methods:{...U(W,["get"]),onChange(l){console.func("components/UserSelect:methods.onChange()",arguments),this.$emit("update:model-value",l)},clear(){console.func("components/UserSelect:methods.clear()",arguments),this.$refs.user.clear()}},computed:{scopedSlots(){return Object.keys(this.$slots).filter(l=>Ge.includes(l))}}};function Ye(l,e,p,w,o,d){const r=x("base-select");return i(),_(r,{ref:"user",placeholder:l.$t("placeholder.selectMember"),"model-value":p.modelValue,"filter-method":l.get,"map-options":"","hide-no-option":p.hideNoOption,"option-label":p.optionLabel,query:a=>({filter:a,rowsPerPage:10,option:!0,blocked:!0}),"onUpdate:modelValue":d.onChange,onNewValue:p.onNewValue},T({_:2},[S(d.scopedSlots,a=>({name:a,fn:n(m=>[N(l.$slots,a,L(m,{props:m}))])}))]),1032,["placeholder","model-value","filter-method","hide-no-option","option-label","query","onUpdate:modelValue","onNewValue"])}var fo=k(Ke,[["render",Ye]]);const Ze={components:{AddressFields:X},props:{modelValue:{type:[Object],required:!0}},data(){return{address:f.exports.cloneDeep(this.modelValue),loading:!1}},emits:["ok","hide"],methods:{show(){console.func("components/customer/AddCustomerDialog:methods.show()",arguments),this.$refs.dialog.show()},hide(){console.func("components/customer/AddCustomerDialog:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/customer/AddCustomerDialog:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/customer/AddCustomerDialog:methods.onDone()",arguments),this.$emit("ok",this.address),this.hide()}},computed:{saveLabel(){return"Create"}}},eo={class:"q-gutter-sm"};function oo(l,e,p,w,o,d){const r=x("address-fields"),a=x("base-dialog");return i(),_(a,{class:"add-customer-dialog",title:"Add Customer","body-class":"scroll",ref:"dialog",persistent:"",onHide:d.onDialogHide,"use-separator":""},{body:n(()=>[s(r,{all:"",modelValue:o.address,"onUpdate:modelValue":e[0]||(e[0]=m=>o.address=m)},null,8,["modelValue"])]),footer:n(()=>[s(q,{class:"text-right"},{default:n(()=>[t("div",eo,[$(s(g,{"no-caps":"",outline:"",label:"Cancel",color:"grey"},null,512),[[P]]),s(g,{"no-caps":"",label:d.saveLabel,color:"primary",onClick:d.onDone},null,8,["label","onClick"])])]),_:1})]),_:1},8,["onHide"])}var _o=k(Ze,[["render",oo]]);export{_o as A,ho as B,po as C,fo as U};
