import{bt as W,A as _,T as D,m as d,_ as x,d as h,o as m,e as g,w as a,g as c,h as o,j as f,t as b,X as M,V as R,f as Y,F as q,p as V,R as Q,N as C,Q as N,al as A,ad as J,s as k,af as F,ck as U,cl as B,aj as $,ak as H,ct as j}from"./index.ec7eb99e.js";import{Q as I}from"./QPage.b13c45b6.js";import{S as E}from"./SkeletonSinglePage.dba71dd3.js";import{C as L}from"./ClassSchedules.ceae0c62.js";import{u as z}from"./template.0c0e15d2.js";import"./QSkeleton.73bc54f6.js";import"./QExpansionItem.38c12bfd.js";import"./QSlideTransition.d1b840b3.js";import"./class-list.c44a0226.js";import"./location.50cdf41d.js";import"./instructor.45275a2f.js";const X=W("class-schedule",{actions:{get(e){return new Promise((t,r)=>{_.get("class-schedules/weekly",e).then(s=>{this.setRows(s.data),t(s)}).catch(s=>{r(s)})})},update(e){return new Promise((t,r)=>{_.post("class-schedules/weekly/update",e).then(s=>{t(s)}).catch(s=>{r(s)})})}}}),G=W("week-template",{actions:{get(e){return new Promise((t,r)=>{_.get("week-templates",e).then(s=>{this.setRows(s.data),t(s)}).catch(s=>{r(s)})})},update(e){return new Promise((t,r)=>{_.post("week-templates/store",e).then(s=>{t(s)}).catch(s=>{r(s)})})}}}),K={data(){return{loading:!1,year:new Date().getFullYear(),month:new Date().getMonth().toString(),months:[{label:"January",value:"0"},{label:"February",value:"1"},{label:"March",value:"2"},{label:"April",value:"3"},{label:"May",value:"4"},{label:"June",value:"5"},{label:"July",value:"6"},{label:"August",value:"7"},{label:"September",value:"8"},{label:"October",value:"9"},{label:"November",value:"10"},{label:"December",value:"11"}],default:[],weeks:[]}},emits:["ok","hide"],methods:{...D(G,["get","update"]),...D(z,{getTemplate:"get"}),show(){console.func("components/AssignScheduleTemplate:methods.show()",arguments),this.$refs.dialog.show(),this.getTemplates()},hide(){console.func("components/AssignScheduleTemplate:methods.close()",arguments),this.$refs.dialog.hide()},onDialogHide(){console.func("components/AssignScheduleTemplate:methods.onDialogHide()",arguments),this.$emit("hide")},onDone(){console.func("components/AssignScheduleTemplate:methods.onDone()",arguments),this.update({weeks:this.weeks}).then(({message:e})=>{this.$q.notify(e),this.$emit("ok"),this.hide(),this.loading=!1}).catch(e=>{this.$core.error(e,{title:this.$t("dialog.title.error")}),this.loading=!1})},getTemplates(){console.func("components/AssignScheduleTemplate:methods.getTemplates()",arguments),this.loading=!0,this.get({month:this.month,year:this.year}).then(e=>{this.weeks=e,this.default=d.exports.cloneDeep(e),this.loading=!1}).catch(()=>{this.$core.error(error,{title:this.$t("dialog.title.error")}),this.loading=!1})}},computed:{years(){return d.exports.range(this.year-2,this.year+5,1)},disable(){return JSON.stringify(this.default)===JSON.stringify(this.weeks)}}},Z={class:"row q-col-gutter-md"},ee={class:"col-sm-6 col-xs-6"},te={class:"col-sm-6 col-xs-6"},se={class:"col-xs-12"},le={class:"text-subtitle2"},oe={class:"q-gutter-sm"};function ae(e,t,r,s,l,n){const u=h("base-select"),S=h("base-info"),w=h("base-dialog");return m(),g(w,{title:e.$t("weekSchedules.dialog.title"),"body-class":"scroll assign-schedule-template","content-style":"width: 700px; max-width: 95vw",ref:"dialog",persistent:"",onHide:n.onDialogHide,"use-separator":""},{body:a(()=>[c("div",Z,[c("div",ee,[o(u,{"options-dense":"",modelValue:l.year,"onUpdate:modelValue":[t[0]||(t[0]=i=>l.year=i),n.getTemplates],options:n.years,dense:"",outlined:""},null,8,["modelValue","options","onUpdate:modelValue"])]),c("div",te,[o(u,{"options-dense":"","map-options":"",modelValue:l.month,"onUpdate:modelValue":[t[1]||(t[1]=i=>l.month=i),n.getTemplates],options:l.months,"option-label":i=>e.$t("months."+i.label),dense:"",outlined:"","emit-value":""},null,8,["modelValue","options","option-label","onUpdate:modelValue"])]),c("div",se,[o(S,null,{default:a(()=>[f(b(e.$t("weekSchedules.dialog.warning")),1)]),_:1}),o(M,{class:"q-mt-md"}),o(R,{class:"bordered weeks"},{default:a(()=>[(m(!0),Y(q,null,V(l.weeks,(i,v)=>(m(),g(Q,{key:v},{default:a(()=>[o(C,null,{default:a(()=>[c("div",le,[o(N,{name:"fas fa-calendar",class:"q-mr-sm"}),f(" "+b(i.start_of_week_formated),1)])]),_:2},1024),o(C,null,{default:a(()=>[o(u,{placeholder:e.$t("placeholder.select"),dense:"",borderless:"",modelValue:i.template,"onUpdate:modelValue":p=>i.template=p,"filter-method":e.getTemplate,"map-options":"","use-filter":"",query:p=>({filter:p,direction:"desc",rowsPerPage:5,sortBy:"id"}),"option-label":"label","option-value":"id"},null,8,["placeholder","modelValue","onUpdate:modelValue","filter-method","query"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),footer:a(()=>[o(A,{class:"text-right"},{default:a(()=>[c("div",oe,[J(o(k,{"no-caps":"",outline:"",label:e.$t("cancel"),color:"grey"},null,8,["label"]),[[F]]),o(k,{disable:n.disable,"no-caps":"",label:e.$t("update"),color:"primary",onClick:n.onDone},null,8,["disable","label","onClick"])])]),_:1})]),loading:a(()=>[o(U,{showing:l.loading},{default:a(()=>[o(B,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1},8,["title","onHide"])}var ne=x(K,[["render",ae]]);const{formatDate:P,subtractFromDate:re,getDayOfWeek:ie}=j,de=(e=null)=>P(re(e,{days:ie(e)-1}),"YYYY-MM-DD"),O={Monday:[],Tuesday:[],Wednesday:[],Thursday:[],Friday:[],Saturday:[],Sunday:[]},ue=e=>{let t=d.exports.groupBy(e,s=>s.day),r=d.exports.cloneDeep(O);return Object.keys(r).forEach(s=>{r[s]=t[s]||[]}),r},ce={components:{SkeletonSinglePage:E,ClassSchedules:L},data(){return{default:d.exports.cloneDeep(O),schedules:d.exports.cloneDeep(O),loaded:!1,submited:!1,startOfWeek:de(new Date),previousOfWeek:null,nextOfWeek:null,formatDate:P}},methods:{...D(X,["get","update"]),onRequest(e){console.func("pages/admins/ClassSchedulesPage:methods.onRequest()",arguments),this.loading=!0,this.get({startOfWeek:e}).then(({previousOfWeek:t,startOfWeek:r,nextOfWeek:s,data:l})=>{this.loaded=!1,this.$nextTick(()=>{const n=ue(l);this.schedules=n,this.default=d.exports.cloneDeep(n),this.loaded=!0}),this.previousOfWeek=t,this.startOfWeek=r,this.nextOfWeek=s,this.loading=!1}).catch(t=>{this.$core.error(t,{title:this.$t("dialog.title.error")})})},onSubmit(e){console.func("pages/admins/ClassSchedulesPage:methods.onSubmit()",arguments),this.submited=!0;const t=[].concat(...Object.values(d.exports.cloneDeep(this.schedules)));this.update({start_of_week:this.startOfWeek,class_schedules:t}).then(({message:r})=>{this.submited=!1,this.loaded=!1,this.$nextTick(()=>{this.default=d.exports.cloneDeep(this.schedules),this.loaded=!0}),this.$q.notify(r)}).catch(r=>{this.submited=!1,this.$core.error(r,{title:this.$t("dialog.title.error")})})},onReset(e){console.func("pages/admins/ClassSchedulesPage:methods.onReset()",arguments),this.loaded=!1,this.$nextTick(()=>{this.schedules=d.exports.cloneDeep(this.default),this.loaded=!0})},onCancel(e){console.func("pages/admins/ClassSchedulesPage:methods.onCancel()",arguments),this.$router.go(-1)},assignScheduleTemplate(){console.func("pages/admins/ClassSchedulesPage:methods.assignScheduleTemplate()",arguments),this.$q.dialog({component:ne}).onOk(e=>{this.onRequest(this.startOfWeek)})}},async mounted(){this.onRequest()},computed:{disable(){return this.default&&JSON.stringify(this.schedules)===JSON.stringify(this.default)},resetable(){return this.default&&JSON.stringify(this.schedules)!==JSON.stringify(this.default)}}},he={class:"q-gutter-md"},me={class:"q-gutter-y-xs"};function pe(e,t,r,s,l,n){const u=h("base-tooltip"),S=h("class-schedules"),w=h("base-section"),i=h("base-form"),v=h("skeleton-single-page");return m(),g(I,{padding:""},{default:a(()=>[l.loaded?(m(),g(i,{key:0,onSubmit:n.onSubmit,onCancel:n.onCancel,onReset:n.onReset,resetable:n.resetable,disable:n.disable,submited:l.submited,ref:"baseForm"},{default:a(()=>[c("div",he,[o(w,{flat:"",bordered:"",title:e.$t("classSchedules.title"),description:e.$t("classSchedules.generalDesc"),"no-row":""},{default:a(()=>[o($,{class:"q-pa-none"},{default:a(()=>[o(H,{class:"text-body1 text-bold"},{default:a(()=>[f(" Week: "+b(l.formatDate(l.startOfWeek,"DD/MM/YYYY")),1)]),_:1}),o(k,{color:"primary",flat:"",round:"",dense:"",icon:"fas fa-calendar-lines-pen",onClick:n.assignScheduleTemplate},{default:a(()=>[o(u,null,{default:a(()=>t[4]||(t[4]=[f("Edit/View Weeks")])),_:1})]),_:1},8,["onClick"]),o(k,{color:"primary",flat:"",round:"",dense:"",icon:"fas fa-angle-left",onClick:t[0]||(t[0]=p=>n.onRequest(l.previousOfWeek))},{default:a(()=>[o(u,null,{default:a(()=>[f(" Previous Week ("+b(l.formatDate(l.previousOfWeek,"DD/MM/YYYY"))+") ",1)]),_:1})]),_:1}),o(k,{color:"primary",flat:"",round:"",dense:"",icon:"fas fa-circle",onClick:t[1]||(t[1]=p=>n.onRequest())},{default:a(()=>[o(u,null,{default:a(()=>[f(" Current Week("+b(l.formatDate(new Date,"DD/MM/YYYY"))+") ",1)]),_:1})]),_:1}),o(k,{color:"primary",flat:"",round:"",dense:"",icon:"fas fa-angle-right",onClick:t[2]||(t[2]=p=>n.onRequest(l.nextOfWeek))},{default:a(()=>[o(u,null,{default:a(()=>[f(" Next Week ("+b(l.formatDate(l.nextOfWeek,"DD/MM/YYYY"))+") ",1)]),_:1})]),_:1})]),_:1}),c("div",me,[(m(!0),Y(q,null,V(l.schedules,(p,y)=>(m(),g(S,{key:y,day:y,rows:l.schedules[y],"onUpdate:rows":T=>l.schedules[y]=T,group:"schedules","default-opened":y==="Monday","can-save":!n.disable,onSave:t[3]||(t[3]=T=>e.$refs.baseForm.onSave()),"start-of-week":l.startOfWeek},null,8,["day","rows","onUpdate:rows","default-opened","can-save","start-of-week"]))),128))])]),_:1},8,["title","description"])])]),_:1},8,["onSubmit","onCancel","onReset","resetable","disable","submited"])):(m(),g(v,{key:1}))]),_:1})}var Te=x(ce,[["render",pe]]);export{Te as default};
